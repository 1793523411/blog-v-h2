---
time: 2021-02-24
icon: template
category: é¢è¯•
article: false
sidebar: auto
footer: ğŸ˜ğŸ˜ğŸ˜
tag:
  - å‰ç«¯
  - JavaScript
---

# Front-end interview-deep copy and shallow copy

## å®šä¹‰

::: tip æµ…æ‹·è´
è‡ªå·±åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ¥æ¥å—ä½ è¦é‡æ–°å¤åˆ¶æˆ–å¼•ç”¨çš„å¯¹è±¡å€¼ã€‚å¦‚æœå¯¹è±¡å±æ€§æ˜¯åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œå¤åˆ¶çš„å°±æ˜¯åŸºæœ¬ç±»å‹çš„å€¼ç»™æ–°å¯¹è±¡ï¼›ä½†å¦‚æœå±æ€§æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œå¤åˆ¶çš„å°±æ˜¯å†…å­˜ä¸­çš„åœ°å€ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªå¯¹è±¡æ”¹å˜äº†è¿™ä¸ªå†…å­˜ä¸­çš„åœ°å€ï¼Œè‚¯å®šä¼šå½±å“åˆ°å¦ä¸€ä¸ªå¯¹è±¡ã€‚
:::

æµ…æ‹·è´åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¤åˆ¶äº†åŸæœ‰å¯¹è±¡çš„åŸºæœ¬ç±»å‹çš„å€¼ï¼Œè€Œå¼•ç”¨æ•°æ®ç±»å‹åªæ‹·è´äº†ä¸€å±‚å±æ€§ï¼Œå†æ·±å±‚çš„è¿˜æ˜¯æ— æ³•è¿›è¡Œæ‹·è´ã€‚æ·±æ‹·è´åˆ™ä¸åŒï¼Œå¯¹äºå¤æ‚å¼•ç”¨æ•°æ®ç±»å‹ï¼Œå…¶åœ¨å †å†…å­˜ä¸­å®Œå…¨å¼€è¾Ÿäº†ä¸€å—å†…å­˜åœ°å€ï¼Œå¹¶å°†åŸæœ‰çš„å¯¹è±¡å®Œå…¨å¤åˆ¶è¿‡æ¥å­˜æ”¾ã€‚è¿™ä¸¤ä¸ªå¯¹è±¡æ˜¯ç›¸äº’ç‹¬ç«‹ã€ä¸å—å½±å“çš„ï¼Œå½»åº•å®ç°äº†å†…å­˜ä¸Šçš„åˆ†ç¦»

::: tip æ·±æ‹·è´
å°†ä¸€ä¸ªå¯¹è±¡ä»å†…å­˜ä¸­å®Œæ•´åœ°æ‹·è´å‡ºæ¥ä¸€ä»½ç»™ç›®æ ‡å¯¹è±¡ï¼Œå¹¶ä»å †å†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ªå…¨æ–°çš„ç©ºé—´å­˜æ”¾æ–°å¯¹è±¡ï¼Œä¸”æ–°å¯¹è±¡çš„ä¿®æ”¹å¹¶ä¸ä¼šæ”¹å˜åŸå¯¹è±¡ï¼ŒäºŒè€…å®ç°çœŸæ­£çš„åˆ†ç¦»ã€‚
:::

## æµ…æ‹·è´

è¿™æœ‰äº”ç§å®ç°æ–¹å¼ï¼š

### object.assign

object.assign æ˜¯ ES6 ä¸­ object çš„ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥ç”¨äº JS å¯¹è±¡çš„åˆå¹¶ç­‰å¤šä¸ªç”¨é€”ï¼Œå…¶ä¸­ä¸€ä¸ªç”¨é€”å°±æ˜¯å¯ä»¥è¿›è¡Œæµ…æ‹·è´ã€‚è¯¥æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ‹·è´çš„ç›®æ ‡å¯¹è±¡ï¼Œåé¢çš„å‚æ•°æ˜¯æ‹·è´çš„æ¥æºå¯¹è±¡ï¼ˆä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªæ¥æºï¼‰

```js
let target = {};
let source = { a: { b: 1 } };
Object.assign(target, source);
console.log(target); // { a: { b: 1 } };
```

::: tip å…³äº Symbol

```js
let obj1 = { a: { b: 1 }, sym: Symbol(1) };
Object.defineProperty(obj1, "innumerable", {
  value: "ä¸å¯æšä¸¾å±æ€§",
  enumerable: false,
});
let obj2 = {};
Object.assign(obj2, obj1);
obj1.a.b = 2;
console.log("obj1", obj1);
console.log("obj2", obj2);
```

åˆ©ç”¨ object.assign ä¹Ÿå¯ä»¥æ‹·è´ Symbol ç±»å‹çš„å¯¹è±¡ï¼Œä½†æ˜¯å¦‚æœåˆ°äº†å¯¹è±¡çš„ç¬¬äºŒå±‚å±æ€§ obj1.a.b è¿™é‡Œçš„æ—¶å€™ï¼Œå‰è€…å€¼çš„æ”¹å˜ä¹Ÿä¼šå½±å“åè€…çš„ç¬¬äºŒå±‚å±æ€§çš„å€¼ï¼Œè¯´æ˜å…¶ä¸­ä¾æ—§å­˜åœ¨ç€è®¿é—®å…±åŒå †å†…å­˜çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ç§æ–¹æ³•è¿˜ä¸èƒ½è¿›ä¸€æ­¥å¤åˆ¶ï¼Œè€Œåªæ˜¯å®Œæˆäº†æµ…æ‹·è´çš„åŠŸèƒ½
:::

::: warning ä½¿ç”¨ object.assign çš„æ³¨æ„ç‚¹

1. å®ƒä¸ä¼šæ‹·è´å¯¹è±¡çš„ç»§æ‰¿å±æ€§ï¼›
2. å®ƒä¸ä¼šæ‹·è´å¯¹è±¡çš„ä¸å¯æšä¸¾çš„å±æ€§ï¼›
3. å¯ä»¥æ‹·è´ Symbol ç±»å‹çš„å±æ€§ã€‚

å¯ä»¥ç®€å•ç†è§£ä¸ºï¼šObject.assign å¾ªç¯éå†åŸå¯¹è±¡çš„å±æ€§ï¼Œé€šè¿‡å¤åˆ¶çš„æ–¹å¼å°†å…¶èµ‹å€¼ç»™ç›®æ ‡å¯¹è±¡çš„ç›¸åº”å±æ€§
:::

### æ‰©å±•è¿ç®—ç¬¦

```js
/* å¯¹è±¡çš„æ‹·è´ */
let obj = { a: 1, b: { c: 1 } };
let obj2 = { ...obj };
obj.a = 2;
console.log(obj); //{a:2,b:{c:1}} console.log(obj2); //{a:1,b:{c:1}}
obj.b.c = 2;
console.log(obj); //{a:2,b:{c:2}} console.log(obj2); //{a:1,b:{c:2}}
/* æ•°ç»„çš„æ‹·è´ */
let arr = [1, 2, 3];
let newArr = [...arr]; //è·Ÿarr.slice()æ˜¯ä¸€æ ·çš„æ•ˆæœ
```

æ‰©å±•è¿ç®—ç¬¦ å’Œ object.assign æœ‰åŒæ ·çš„ç¼ºé™·ï¼Œä¹Ÿå°±æ˜¯å®ç°çš„æµ…æ‹·è´çš„åŠŸèƒ½å·®ä¸å¤šï¼Œä½†æ˜¯å¦‚æœå±æ€§éƒ½æ˜¯åŸºæœ¬ç±»å‹çš„å€¼ï¼Œä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦è¿›è¡Œæµ…æ‹·è´ä¼šæ›´åŠ æ–¹ä¾¿

### concat æ‹·è´æ•°ç»„

æ•°ç»„çš„ concat æ–¹æ³•æ˜¯æµ…æ‹·è´ï¼Œæ‰€ä»¥è¿æ¥ä¸€ä¸ªå«æœ‰å¼•ç”¨ç±»å‹çš„æ•°ç»„æ—¶ï¼Œéœ€è¦æ³¨æ„ä¿®æ”¹åŸæ•°ç»„ä¸­çš„å…ƒç´ çš„å±æ€§ï¼Œå› ä¸ºå®ƒä¼šå½±å“æ‹·è´ä¹‹åè¿æ¥çš„æ•°ç»„ã€‚ä¸è¿‡ concat åªèƒ½ç”¨äºæ•°ç»„çš„æµ…æ‹·è´ï¼Œä½¿ç”¨åœºæ™¯æ¯”è¾ƒå±€é™

```js
let arr = [1, 2, 3];
let newArr = arr.concat();
newArr[1] = 100;
console.log(arr); // [ 1, 2, 3 ]
console.log(newArr); // [ 1, 100, 3 ]
```

### slice æ‹·è´æ•°ç»„

slice æ–¹æ³•ä¹Ÿæ¯”è¾ƒæœ‰å±€é™æ€§ï¼Œå› ä¸ºå®ƒä»…ä»…é’ˆå¯¹æ•°ç»„ç±»å‹ã€‚slice æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„å¯¹è±¡ï¼Œè¿™ä¸€å¯¹è±¡ç”±è¯¥æ–¹æ³•çš„å‰ä¸¤ä¸ªå‚æ•°æ¥å†³å®šåŸæ•°ç»„æˆªå–çš„å¼€å§‹å’Œç»“æŸæ—¶é—´ï¼Œæ˜¯ä¸ä¼šå½±å“å’Œæ”¹å˜åŸå§‹æ•°ç»„çš„

```js
let arr = [1, 2, { val: 4 }];
let newArr = arr.slice();
newArr[2].val = 1000;
console.log(arr); //[ 1, 2, { val: 1000 } ]
```

### æ‰‹åŠ¨å®ç°æµ…æ‹·è´

æŠŠæ¡ä¸¤ç‚¹ï¼š

- å¯¹åŸºç¡€ç±»å‹åšä¸€ä¸ªæœ€åŸºæœ¬çš„ä¸€ä¸ªæ‹·è´ï¼›
- å¯¹å¼•ç”¨ç±»å‹å¼€è¾Ÿä¸€ä¸ªæ–°çš„å­˜å‚¨ï¼Œå¹¶ä¸”æ‹·è´ä¸€å±‚å¯¹è±¡å±æ€§

```js
const shallowClone = (target) => {
  if (typeof target === "object" && target !== null) {
    const cloneTarget = Array.isArray(target) ? [] : {};
    for (let prop in target) {
      if (target.hasOwnProperty(prop)) {
        cloneTarget[prop] = target[prop];
      }
    }
    return cloneTarget;
  } else {
    return target;
  }
};
```

::: tip
ä½¿ç”¨ for-in å¾ªç¯æ—¶ï¼Œè¿”å›çš„æ˜¯æ‰€æœ‰èƒ½å¤Ÿé€šè¿‡å¯¹è±¡è®¿é—®çš„ã€å¯æšä¸¾çš„å±æ€§ï¼Œå…¶ä¸­åŒ…æ‹¬äº†å­˜åœ¨äºå®ä¾‹ä¸­çš„å±æ€§ï¼Œä¹ŸåŒ…æ‹¬äº†å­˜åœ¨äºåŸå‹ä¸­çš„å±æ€§
:::

## æ·±æ‹·è´

### JSON.stringfy

æŠŠä¸€ä¸ªå¯¹è±¡åºåˆ—åŒ–æˆä¸º JSON çš„å­—ç¬¦ä¸²ï¼Œå¹¶å°†å¯¹è±¡é‡Œé¢çš„å†…å®¹è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œæœ€åå†ç”¨ JSON.parse() çš„æ–¹æ³•å°† JSON å­—ç¬¦ä¸²ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡

```js
let obj1 = { a:1, b:[1,2,3] }
let str = JSON.stringify(obj1)ï¼›
let obj2 = JSON.parse(str)ï¼›
console.log(obj2);   //{a:1,b:[1,2,3]}
obj1.a = 2ï¼›
obj1.b.push(4);
console.log(obj1);   //{a:2,b:[1,2,3,4]}
console.log(obj2);   //{a:1,b:[1,2,3]}
```

::: tip ä½¿ç”¨ JSON.stringfy å®ç°æ·±æ‹·è´è¿˜æ˜¯æœ‰ä¸€äº›åœ°æ–¹å€¼å¾—æ³¨æ„:

1. æ‹·è´çš„å¯¹è±¡çš„å€¼ä¸­å¦‚æœæœ‰å‡½æ•°ã€undefinedã€symbol è¿™å‡ ç§ç±»å‹ï¼Œç»è¿‡ JSON.stringify åºåˆ—åŒ–ä¹‹åçš„å­—ç¬¦ä¸²ä¸­è¿™ä¸ªé”®å€¼å¯¹ä¼šæ¶ˆå¤±ï¼›
2. æ‹·è´ Date å¼•ç”¨ç±»å‹ä¼šå˜æˆå­—ç¬¦ä¸²ï¼›
3. æ— æ³•æ‹·è´ä¸å¯æšä¸¾çš„å±æ€§ï¼›
4. æ— æ³•æ‹·è´å¯¹è±¡çš„åŸå‹é“¾ï¼›
5. æ‹·è´ RegExp å¼•ç”¨ç±»å‹ä¼šå˜æˆç©ºå¯¹è±¡ï¼›
6. å¯¹è±¡ä¸­å«æœ‰ NaNã€Infinity ä»¥åŠ -Infinityï¼ŒJSON åºåˆ—åŒ–çš„ç»“æœä¼šå˜æˆ nullï¼›
7. æ— æ³•æ‹·è´å¯¹è±¡çš„å¾ªç¯åº”ç”¨ï¼Œå³å¯¹è±¡æˆç¯ `(obj[key] = obj)`ã€‚

:::

æ‰€ä»¥ JSON.stringify æ— æ³•åº”å¯¹æ¯”è¾ƒéº»çƒ¦çš„å±æ€§å¯¹åº”çš„æ•°æ®ç±»å‹

### åŸºç¡€ç‰ˆ-æ‰‹å†™é€’å½’å®ç°

```js
let obj1 = {
  a: {
    b: 1,
  },
};
function deepClone(obj) {
  if (typeof obj == "object") {
    let cloneObj = (obj.constructor = Array ? [] : {});
    for (let key in obj) {
      //éå†
      if (typeof obj[key] === "object") {
        cloneObj[key] = deepClone(obj[key]); //æ˜¯å¯¹è±¡å°±å†æ¬¡è°ƒç”¨è¯¥å‡½æ•°é€’å½’
      } else {
        cloneObj[key] = obj[key]; //åŸºæœ¬ç±»å‹çš„è¯ç›´æ¥å¤åˆ¶å€¼
      }
    }
  } else {
      let cloneObj = obj
  }

  return cloneObj;
}
let obj2 = deepClone(obj1);
obj1.a.b = 2;
console.log(obj2); //  {a:{b:1}}
```

::: tip åŒä¸Šé¢çš„ JSON.stringfy ä¸€æ ·ï¼Œè¿˜æ˜¯æœ‰ä¸€äº›é—®é¢˜æ²¡æœ‰å®Œå…¨è§£å†³

1. è¿™ä¸ªæ·±æ‹·è´å‡½æ•°å¹¶ä¸èƒ½å¤åˆ¶ä¸å¯æšä¸¾çš„å±æ€§ä»¥åŠ Symbol ç±»å‹ï¼›
2. è¿™ç§æ–¹æ³•åªæ˜¯é’ˆå¯¹æ™®é€šçš„å¼•ç”¨ç±»å‹çš„å€¼åšé€’å½’å¤åˆ¶ï¼Œè€Œå¯¹äº Arrayã€Dateã€RegExpã€Errorã€Function è¿™æ ·çš„å¼•ç”¨ç±»å‹å¹¶ä¸èƒ½æ­£ç¡®åœ°æ‹·è´ï¼›
3. å¯¹è±¡çš„å±æ€§é‡Œé¢æˆç¯ï¼Œå³å¾ªç¯å¼•ç”¨æ²¡æœ‰è§£å†³ã€‚

:::

### æ”¹è¿›ç‰ˆ-æ‰‹å†™é€’å½’å®ç°

1. é’ˆå¯¹èƒ½å¤Ÿéå†å¯¹è±¡çš„ä¸å¯æšä¸¾å±æ€§ä»¥åŠ Symbol ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Reflect.ownKeys æ–¹æ³•ï¼›
2. å½“å‚æ•°ä¸º Dateã€RegExp ç±»å‹ï¼Œåˆ™ç›´æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„å®ä¾‹è¿”å›ï¼›
3. åˆ©ç”¨ Object çš„ getOwnPropertyDescriptors æ–¹æ³•å¯ä»¥è·å¾—å¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œä»¥åŠå¯¹åº”çš„ç‰¹æ€§ï¼Œé¡ºä¾¿ç»“åˆ Object çš„ create æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¹¶ç»§æ‰¿ä¼ å…¥åŸå¯¹è±¡çš„åŸå‹é“¾ï¼›
4. åˆ©ç”¨ WeakMap ç±»å‹ä½œä¸º Hash è¡¨ï¼Œå› ä¸º WeakMap æ˜¯å¼±å¼•ç”¨ç±»å‹ï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢å†…å­˜æ³„æ¼ï¼Œä½œä¸ºæ£€æµ‹å¾ªç¯å¼•ç”¨å¾ˆæœ‰å¸®åŠ©ï¼Œå¦‚æœå­˜åœ¨å¾ªç¯ï¼Œåˆ™å¼•ç”¨ç›´æ¥è¿”å› WeakMap å­˜å‚¨çš„å€¼ã€‚

```js
const isComplexDataType = (obj) =>
  (typeof obj === "object" || typeof obj === "function") && obj !== null;
const deepClone = function(obj, hash = new WeakMap()) {
  if (obj.constructor === Date) return new Date(obj); // æ—¥æœŸå¯¹è±¡ç›´æ¥è¿”å›ä¸€ä¸ªæ–°çš„æ—¥æœŸå¯¹è±¡
  if (obj.constructor === RegExp) return new RegExp(obj); //æ­£åˆ™å¯¹è±¡ç›´æ¥è¿”å›ä¸€ä¸ªæ–°çš„æ­£åˆ™å¯¹è±¡
  //å¦‚æœå¾ªç¯å¼•ç”¨äº†å°±ç”¨ weakMap æ¥è§£å†³
  if (hash.has(obj)) return hash.get(obj);
  let allDesc = Object.getOwnPropertyDescriptors(obj);
  //éå†ä¼ å…¥å‚æ•°æ‰€æœ‰é”®çš„ç‰¹æ€§
  let cloneObj = Object.create(Object.getPrototypeOf(obj), allDesc);
  //ç»§æ‰¿åŸå‹é“¾
  hash.set(obj, cloneObj);
  for (let key of Reflect.ownKeys(obj)) {
    cloneObj[key] =
      isComplexDataType(obj[key]) && typeof obj[key] !== "function"
        ? deepClone(obj[key], hash)
        : obj[key];
  }
  return cloneObj;
};
// ä¸‹é¢æ˜¯éªŒè¯ä»£ç 
let obj = {
  num: 0,
  str: "",
  boolean: true,
  unf: undefined,
  nul: null,
  obj: { name: "æˆ‘æ˜¯ä¸€ä¸ªå¯¹è±¡", id: 1 },
  arr: [0, 1, 2],
  func: function() {
    console.log("æˆ‘æ˜¯ä¸€ä¸ªå‡½æ•°");
  },
  date: new Date(0),
  reg: new RegExp("/æˆ‘æ˜¯ä¸€ä¸ªæ­£åˆ™/ig"),
  [Symbol("1")]: 1,
};
Object.defineProperty(obj, "innumerable", {
  enumerable: false,
  value: "ä¸å¯æšä¸¾å±æ€§",
});
obj = Object.create(obj, Object.getOwnPropertyDescriptors(obj));
obj.loop = obj; // è®¾ç½®loopæˆå¾ªç¯å¼•ç”¨çš„å±æ€§
let cloneObj = deepClone(obj);
cloneObj.arr.push(4);
console.log("obj", obj);
console.log("cloneObj", cloneObj);
```
