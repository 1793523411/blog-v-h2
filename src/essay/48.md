---
time: 2021-04-09
icon: template
category: é¢è¯•
article: true
sidebar: auto
footer: ğŸ˜ğŸ˜ğŸ˜
tag:
  - å‰ç«¯
---

# react-router summary

```
yarn add react-router-dom
```

## ç›¸å…³æ ‡ç­¾

```js
import {
  BrowserRouter,
  HashRouter,
  Route,
  Redirect,
  Switch,
  Link,
  NavLink,
  withRouter,
} from "react-router-dom";
```

## è·¯ç”±è·³è½¬

```js
import { BrowserRouter as Router, Route, Link } from "react-router-dom";
import Home from "./home";
import About from "./about";

//....
<Router>
  <Link to="/home" className="link">
    è·³è½¬Homeé¡µé¢
  </Link>
  <Link to="/about" className="link">
    è·³è½¬Abouté¡µé¢
  </Link>
  <Route path="/home" component={Home} />
  <Route path="/about" component={About} />
</Router>;
```

- Route ç»„ä»¶å¿…é¡»åœ¨ Router ç»„ä»¶å†…éƒ¨
- Link ç»„ä»¶çš„ to å±æ€§çš„å€¼ä¸ºç‚¹å‡»åè·³è½¬çš„è·¯å¾„
- Route ç»„ä»¶çš„ path å±æ€§æ˜¯ä¸ Link æ ‡ç­¾çš„ to å±æ€§åŒ¹é…çš„; component å±æ€§è¡¨ç¤º Route ç»„ä»¶åŒ¹é…æˆåŠŸåæ¸²æŸ“çš„ç»„ä»¶å¯¹è±¡

### åµŒå¥—è·¯ç”±è·³è½¬

`/home/one` å’Œ `/home/two` ä¸ºä¸Šä¸€çº§è·¯ç”± `/home` çš„äºŒçº§åµŒå¥—è·¯ç”±

```js
import React from 'react'
import {
    Route,
    Link,
} from 'react-router-dom'

function Home () {

    return (
        <>
            æˆ‘æ˜¯Homeé¡µé¢
            <Link to="/home/one">è·³è½¬åˆ°Home/oneé¡µé¢</Link>
            <Link to="/home/two">è·³è½¬åˆ°Home/twoé¡µé¢</Link>

            <Route path="/home/one" component={One}/>
            <Route path="/home/two" component={Two}/>
        </>
    )
```

Home ç»„ä»¶ä¸­çš„è·¯ç”±ç»„ä»¶ One çš„äºŒçº§è·¯ç”±è·¯å¾„åŒ¹é…å¿…é¡»è¦å†™ /home/one ï¼Œè€Œä¸æ˜¯ /one ï¼Œä¸è¦ä»¥ä¸º One ç»„ä»¶çœ‹ä¼¼åœ¨ Home ç»„ä»¶å†…å°±å¯ä»¥ç®€å†™æˆ /one

### å‡½æ•°å¼è·¯ç”±

æœ‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ›´çµæ´»çš„æ–¹å¼è¿›è¡Œè·³è½¬è·¯ç”±ï¼Œä¾‹å¦‚é€šè¿‡è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œéšæ—¶éšåœ°è¿›è¡Œè·¯ç”±è·³è½¬ï¼Œè¿™å°±å«å‡½æ•°å¼è·¯ç”±

å‡½æ•°å¼è·¯ç”±ç”¨åˆ°çš„æ–¹æ³•æœ‰ä»¥ä¸‹ 5 ä¸ªæ–¹æ³•åˆ†åˆ«æ˜¯ `push`ã€`replace`ã€`goForward`ã€`goBack`ã€`go`ï¼Œæ¥ä¸‹æ¥æŒ‰é¡ºåºä»‹ç»ä¸€ä¸‹è¿™å‡ ä¸ªæ–¹æ³•

- push æ–¹æ³•å°±æ˜¯ä½¿é¡µé¢è·³è½¬åˆ°å¯¹åº”è·¯å¾„ï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­ç•™ä¸‹è®°å½•ï¼ˆå³å¯ä»¥é€šè¿‡æµè§ˆå™¨çš„å›é€€æŒ‰é’®ï¼Œè¿”å›ä¸Šä¸€ä¸ªé¡µé¢ï¼‰
- replace æ–¹æ³•ä¸ push æ–¹æ³•ç±»ä¼¼ï¼Œä¸ä¸€æ ·çš„åœ°æ–¹å°±æ˜¯ï¼Œè·³è½¬åä¸ä¼šåœ¨æµè§ˆå™¨ä¸­ä¿å­˜ä¸Šä¸€ä¸ªé¡µé¢çš„è®°å½•ï¼ˆå³æ— æ³•é€šè¿‡æµè§ˆå™¨çš„å›é€€æŒ‰é’®ï¼Œè¿”å›ä¸Šä¸€ä¸ªé¡µé¢ï¼‰
- è°ƒç”¨ goForward æ–¹æ³•ï¼Œå°±ç›¸å½“äºç‚¹å‡»äº†æµè§ˆå™¨çš„è¿”å›ä¸‹ä¸€ä¸ªé¡µé¢æŒ‰é’®
- è°ƒç”¨ goBack æ–¹æ³•ï¼Œå°±ç›¸å½“äºç‚¹å‡»äº†æµè§ˆå™¨çš„è¿”å›ä¸Šä¸€ä¸ªé¡µé¢çš„æŒ‰é’®
- go æ–¹æ³•é¡¾åæ€ä¹‰ï¼Œæ˜¯ç”¨äºè·³è½¬åˆ°æŒ‡å®šè·¯å¾„çš„ã€‚è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªå‚æ•°ï¼ˆå‚æ•°ç±»å‹ä¸º Numberï¼‰ï¼Œæƒ…å†µå¦‚ä¸‹ï¼š
  - å½“å‚æ•°ä¸ºæ­£æ•° n æ—¶ï¼Œè¡¨ç¤ºè·³è½¬åˆ°ä¸‹ n ä¸ªé¡µé¢ã€‚ä¾‹å¦‚ go(1) ç›¸å½“äºè°ƒç”¨äº†ä¸€æ¬¡ goForward æ–¹æ³•
  - å½“å‚æ•°ä¸ºè´Ÿæ•° n æ—¶ï¼Œè¡¨ç¤ºè·³è½¬åˆ°ä¸Š n ä¸ªé¡µé¢ã€‚ä¾‹å¦‚ go(-3) ç›¸å½“äºè°ƒç”¨äº†ä¸‰æ¬¡ goBack æ–¹æ³•
  - å½“å‚æ•°ä¸º 0 æ—¶ï¼Œè¡¨ç¤ºåˆ·æ–°å½“å‰é¡µé¢

```js
props.history.push("/about");
props.history.replace("/about");
```

## è·¯ç”±ä¼ å‚

æ‰€æœ‰è·¯ç”±ä¼ é€’çš„å‚æ•°ï¼Œéƒ½ä¼šåœ¨è·³è½¬è·¯ç”±ç»„ä»¶çš„ props ä¸­è·å–åˆ°ï¼Œæ¯ç§ä¼ å‚æ–¹å¼æ¥æ”¶çš„æ–¹å¼ç•¥æœ‰ä¸åŒ

è·¯ç”±ä¼ å‚çš„æ–¹å¼ä¸€å…±æœ‰ä¸‰ç§:

ç¬¬ä¸€ç§æ˜¯åœ¨ Link ç»„ä»¶çš„è·³è½¬è·¯å¾„ä¸Šæºå¸¦å‚æ•°ï¼Œå¹¶åœ¨ Route ç»„ä»¶çš„åŒ¹é…è·¯å¾„ä¸Šé€šè¿‡ :å‚æ•°å çš„æ–¹å¼æ¥æ”¶å‚æ•°

```js
<Router>
  {/* åœ¨ /home çš„è·¯å¾„ä¸Šæºå¸¦äº† å¼ ä¸‰ã€18 å…±ä¸¤ä¸ªå‚æ•° */}
  <NavLink to="/home/å¼ ä¸‰/18" className="link">
    è·³è½¬Homeé¡µé¢
  </NavLink>
  <NavLink to="/about" className="link">
    è·³è½¬Abouté¡µé¢
  </NavLink>

  <Switch>
    {/* åœ¨ /home åŒ¹é…è·¯å¾„ä¸Šç›¸åŒçš„ä½ç½®æ¥æ”¶äº† nameã€age ä¸¤ä¸ªå‚æ•° */}
    <Route path="/home/:name/:age" component={Home} />
    <Route path="/about" component={About} />
  </Switch>
</Router>
```

ç¬¬ä¸€ç§æ–¹å¼çš„å‚æ•°æ˜¯é€šè¿‡ props.match.params æ¥è·å–çš„

ç¬¬äºŒç§æ–¹å¼å°±æ˜¯é€šè¿‡åœ¨ Link ç»„ä»¶çš„è·³è½¬é“¾æ¥åé¢è·Ÿä¸Šä»¥ ? å¼€å¤´ï¼Œç±»ä¼¼ ?a=1&b=3 è¿™æ ·çš„å‚æ•°è¿›è¡Œä¼ é€’

```js
<Router>
  {/* åœ¨è·³è½¬è·¯å¾„åé¢ä»¥?å¼€å¤´ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸ºname=å¼ ä¸‰ã€age=18 */}
  <NavLink to="/home?name=å¼ ä¸‰&age=18" className="link">
    è·³è½¬Homeé¡µé¢
  </NavLink>
  <NavLink to="/about" className="link">
    è·³è½¬Abouté¡µé¢
  </NavLink>

  <Switch>
    {/* æ­¤å¤„æ— éœ€åšæ¥æ”¶æ“ä½œ */}
    <Route path="/home" component={Home} />
    <Route path="/about" component={About} />
  </Switch>
</Router>
```

ç¬¬äºŒç§æ–¹å¼çš„å‚æ•°æ˜¯é€šè¿‡ props.location.search æ¥è·å–çš„ï¼Œä¸è¿‡è¿™é‡Œçš„å‚æ•°éœ€è¦è‡ªå·±ç®€å•åšè¿›ä¸€æ­¥è½¬åŒ–

ç¬¬ä¸‰ç§æ–¹å¼å°±æ˜¯ä»¥å¯¹è±¡çš„å½¢å¼ç¼–å†™ Link ç»„ä»¶çš„ to è·³è½¬å±æ€§ï¼Œå¹¶é€šè¿‡ state å±æ€§æ¥ä¼ é€’å‚æ•°

```js
<Router>
  {/* ä»¥å¯¹è±¡çš„å½¢å¼æè¿°toå±æ€§ï¼Œè·¯å¾„å±æ€§åä¸ºpathnameï¼Œå‚æ•°å±æ€§åä¸ºstate */}
  <NavLink
    to={{ pathname: "/home", state: { name: "å¼ ä¸‰", age: 18 } }}
    className="link"
  >
    è·³è½¬Homeé¡µé¢
  </NavLink>
  <NavLink to="/about" className="link">
    è·³è½¬Abouté¡µé¢
  </NavLink>

  <Switch>
    {/* æ­¤å¤„æ— éœ€ç‰¹åœ°æ¥æ”¶å±æ€§ */}
    <Route path="/home" component={Home} />
    <Route path="/about" component={About} />
  </Switch>
</Router>
```

ç¬¬ä¸‰ç§æ–¹å¼çš„å‚æ•°æ˜¯é€šè¿‡ props.location.state æ¥è·å–çš„

## æ™®é€šç»„ä»¶å’Œè·¯ç”±ç»„ä»¶

é€šè¿‡ Route ç»„ä»¶æ¸²æŸ“çš„ç»„ä»¶ä¸ºè·¯ç”±ç»„ä»¶ ï¼Œå…¶ä½™çš„åŸºæœ¬ä¸Šéƒ½ä¸º æ™®é€šç»„ä»¶

ä¾‹å¦‚ï¼Œä¸‹æ–¹ä»£ç ä¸­ï¼šHome ç»„ä»¶ä¸ºè·¯ç”±ç»„ä»¶ ; App ç»„ä»¶ä¸ºæ™®é€šç»„ä»¶

```js
import {
  BrowserRouter as Router,
  Route,
  NavLink,
  Switch,
} from "react-router-dom";
import Home from "./home";
import About from "./about";

export default function App() {
  return (
    <div className="App">
      <About />
      <Router>
        <NavLink to="/home" className="link">
          è·³è½¬Homeé¡µé¢
        </NavLink>

        <Switch>
          <Route path="/home" component={Home} />
        </Switch>
      </Router>
    </div>
  );
}
```

ç„¶åï¼Œè·¯ç”±ç»„ä»¶è·Ÿæ™®é€šç»„ä»¶æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ï¼Œç»„ä»¶çš„ props å±æ€§ä¸­æ˜¯å¦æœ‰ä¸‹å›¾æ‰€ç¤ºçš„å†…å®¹

```
>{history: {â€¦}, location: {â€¦}, match: {â€¦}, staticContext: undefined}
>history: {length: 4, action: "PUSH", location: {â€¦}, createHref: Æ’, push: Æ’, â€¦}
>location: {pathname: "/home", search: "", hash: "", state: null, key: "oazcus"}
>match: {path: "/home", url: "/home", isExact: true, params: {â€¦}}
>staticContext: undefined
>__proto__: Object
```

æ­¤æ—¶ï¼Œreact-router-dom æä¾›äº†ä¸€ä¸ª withRouter æ–¹æ³•ï¼Œå¯ä»¥ä½¿æ™®é€šç»„ä»¶ä¹Ÿèƒ½åƒè·¯ç”±ç»„ä»¶ä¸€æ ·æœ‰é‚£äº›æ–¹æ³•æˆ–æ•°æ®å¯ä»¥ä½¿ç”¨

```js
import {
  BrowserRouter as Router,
  Route,
  NavLink,
  Switch,
  withRouter, // 1. å¼•å…¥ witRouter
} from "react-router-dom";
import About from "./about";

function App(props) {
  console.log(props); // 3. å°è¯•æ‰“å°æ™®é€šç»„ä»¶Appçš„propsï¼Œå‘ç°æ­¤æ—¶propsä¸­å·²æœ‰å†…å®¹äº†ï¼Œå³æ™®é€šç»„ä»¶ä¹Ÿèƒ½æ‹¥æœ‰è·Ÿè·¯ç”±ç»„ä»¶ä¸€æ ·ç±»ä¼¼çš„åŠŸèƒ½

  return (
    <div className="App">
      <Router>
        <NavLink to="/about" className="link">
          è·³è½¬Abouté¡µé¢
        </NavLink>

        <Switch>
          <Route path="/about" component={About} />
        </Switch>
      </Router>
    </div>
  );
}

export default withRouter(App); // 2. é€šè¿‡withRouteræ–¹æ³•å¯¹æ™®é€šç»„ä»¶åšä¸€å±‚åŒ…è£…å¤„ç†
```

## å…¶ä»–

### åŠ¨æ€é“¾æ¥ NavLink

NavLink å¯ä»¥å°†å½“å‰å¤„äº active çŠ¶æ€çš„é“¾æ¥é™„åŠ ä¸€ä¸ª active ç±»å

```js
<Router>
  <NavLink to="/home" className="link">
    è·³è½¬Homeé¡µé¢
  </NavLink>
  <NavLink to="/about" className="link">
    è·³è½¬Abouté¡µé¢
  </NavLink>
  <Route path="/home" component={Home} />
  <Route path="/about" component={About} />
</Router>
```

```css
/* è®¾ç½®activeç±»çš„æ ·å¼ */
.active {
  font-weight: blod;
  color: red;
}
```

### è·¯ç”±åŒ¹é…ä¼˜åŒ– Switch

å½“ç‚¹å‡»è·³è½¬é“¾æ¥æ—¶ï¼Œä¼šè‡ªåŠ¨å»å°è¯•åŒ¹é…æ‰€æœ‰çš„ Route å¯¹åº”çš„è·¯å¾„,æ­£å¸¸æƒ…å†µä¸‹ï¼Œåªéœ€åŒ¹é…åˆ°ä¸€ä¸ªè§„åˆ™ï¼Œæ¸²æŸ“å³å¯ï¼Œå³åŒ¹é…æˆåŠŸä¸€ä¸ªåï¼Œæ— éœ€è¿›è¡Œåç»­çš„åŒ¹é…å°è¯•ï¼Œæ­¤æ—¶å¯ä»¥ç”¨ Switch ç»„ä»¶

```js
<Router>
  <NavLink to="/home" className="link">
    è·³è½¬Homeé¡µé¢
  </NavLink>
  <NavLink to="/about" className="link">
    è·³è½¬Abouté¡µé¢
  </NavLink>

  <Switch>
    <Route path="/home" component={Home} />
    <Route path="/about" component={About} />
    <Route path="/home" component={Home} />
    <Route path="/home" component={Home} />
    {/* æ­¤å¤„çœç•¥ä¸€ä¸‡ä¸ªRouteç»„ä»¶ */}
    <Route path="/home" component={Home} />
  </Switch>
</Router>
```

å°†å¤šä¸ª Route ç»„ä»¶åŒæ—¶æ”¾åœ¨ä¸€ä¸ª Switch ç»„ä»¶ä¸­ï¼Œå³å¯é¿å…å¤šæ¬¡æ— æ„ä¹‰çš„è·¯ç”±åŒ¹é…ï¼Œä»¥æ­¤æå‡æ€§èƒ½

### é‡å®šå‘ Redirect

å½“é¡µé¢è·³è½¬æ—¶ï¼Œè‹¥è·³è½¬é“¾æ¥æ²¡æœ‰åŒ¹é…ä¸Šä»»ä½•ä¸€ä¸ª Route ç»„ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šæ˜¾ç¤º 404 é¡µé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªé‡å®šå‘ç»„ä»¶ Redirect

```js
<Router>
  <NavLink to="/home" className="link">
    è·³è½¬Homeé¡µé¢
  </NavLink>
  <NavLink to="/about" className="link">
    è·³è½¬Abouté¡µé¢
  </NavLink>
  <NavLink to="/shop" className="link">
    è·³è½¬Shopé¡µé¢
  </NavLink>{" "}
  {/* ç‚¹å‡»ï¼Œè·³è½¬åˆ°/shopï¼Œä½†è¯¥è·¯å¾„æ²¡æœ‰è®¾ç½® */}
  <Switch>
    <Route path="/home" component={Home} />
    <Route path="/about" component={About} />
    <Redirect to="/home" /> {/* å½“ä»¥ä¸ŠRouteç»„ä»¶éƒ½åŒ¹é…å¤±è´¥æ—¶ï¼Œé‡å®šå‘åˆ°/home */}
  </Switch>
</Router>
```

### replace

åœ¨å‡½æ•°å¼è·¯ç”±é‡Œè·³è½¬ç±»å‹ä¸»è¦æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯ push å’Œ replaceï¼Œé‚£ä¹ˆåœ¨éå‡½æ•°å¼è·¯ç”±ä¸­ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥è‡ªå®šä¹‰è·³è½¬ç±»å‹

```js
<Router>
  <Link to="/home" className="link">
    è·³è½¬Homeé¡µé¢
  </Link>
  <Link to="/about" className="link">
    è·³è½¬Abouté¡µé¢
  </Link>
  <Route path="/home" component={Home} replace={true} />{" "}
  {/* replaceä¸ºtrueï¼Œè·³è½¬ç±»å‹ä¸ºreplace */}
  <Route path="/about" component={About} replace={false} /> {/* replaceä¸ºfalseï¼Œè·³è½¬ç±»å‹ä¸ºpush */}
</Router>
```

Route ç»„ä»¶ä¸Šæœ‰ä¸ª replace å±æ€§å¯ä»¥è®¾å®šè·³è½¬ç±»å‹ï¼Œå½“å€¼ä¸º true æ—¶ï¼Œè·³è½¬ç±»å‹ä¸º replace ; ä¸º false æ—¶ï¼Œè·³è½¬ç±»å‹ä¸º push

### excat

è·¯ç”±çš„åŒ¹é…é»˜è®¤æ˜¯æ¨¡ç³ŠåŒ¹é…çš„

```js
<Router>
  <Link to="/home/abc">è·³è½¬Homeé¡µé¢</Link>{" "}
  {/* è·³è½¬åˆ°/home/abcï¼Œä½†å®é™…homeä¸‹æ²¡æœ‰abcè¿™ä¸ªè·¯ç”±ç»„ä»¶ */}
  <Link to="/about/abc">è·³è½¬Abouté¡µé¢</Link> {/* è·³è½¬åˆ°/about/abcï¼Œä½†å®é™…homeä¸‹ä¹Ÿæ²¡æœ‰abcè¿™ä¸ªè·¯ç”±ç»„ä»¶ */}
  <Route path="/home" component={Home} />{" "}
  {/* è·¯ç”±åŒ¹é…è§„åˆ™ä¸º/homeï¼Œæ²¡æœ‰è®¾ç½®exactå±æ€§ï¼Œå½“å‰ä¸ºæ¨¡ç³ŠåŒ¹é… */}
  <Route path="/about" component={About} exact /> {/* è·¯ç”±åŒ¹é…è§„åˆ™ä¸º/aboutï¼Œè®¾ç½®äº†exactå±æ€§ï¼Œå½“å‰ä¸ºç²¾å‡†åŒ¹é… */}
</Router>
```

å› ä¸ºè·³è½¬ /home/abc æ—¶ï¼Œç¬¬ä¸€ä¸ª Route ç»„ä»¶æ˜¯æ¨¡ç³ŠåŒ¹é…çš„ï¼Œæ‰€ä»¥å…ˆåŒ¹é…åˆ°äº† /homeï¼Œå› æ­¤ Home ç»„ä»¶æ¸²æŸ“äº† ; è€Œè·³è½¬ /about/abc æ—¶ï¼Œç¬¬äºŒä¸ª Route ç»„ä»¶æ˜¯ç²¾å‡†åŒ¹é…çš„ï¼Œå³ /about/abc ä¸ç­‰äº /aboutï¼Œæ‰€ä»¥ About ç»„ä»¶ä¹Ÿæ²¡æœ‰æ¸²æŸ“

## æ•´ä½“è¿‡ç¨‹

å…³äº react-router ä¸»è¦åšçš„æœ‰ä¸‰ä»¶äº‹ï¼š

1. ç›‘å¬è·¯ç”±çš„å˜åŒ–
2. åŒ¹é…è·¯å¾„
3. æ¸²æŸ“å¯¹åº”çš„ç»„ä»¶

ç¬¬ä¸€æ­¥ä¸»è¦æ˜¯ç”± react-router ä¸­çš„ router åšå¾—

```js
//react-router/router.js
if (!props.staticContext) {
  this.unlisten = props.history.listen((location) => {
    if (this._isMounted) {
      this.setState({ location });
    } else {
      this._pendingLocation = location;
    }
  });
}
```

ç¬¬äºŒéƒ¨ä¸»è¦æ˜¯ç”± react-router ä¸­çš„ route åšçš„ï¼Œç¬¬äºŒæ­¥ 3 ä¸­æœ‰ä¸€ä¸ªåŒ¹é…çš„é¡ºåºï¼šmatch -> children -> component -> render

match æŒ‡çš„æ˜¯ Switch æ¥åŒ¹é…å¯¹åº”çš„ routeï¼Œchildren å°±æ˜¯å°†è¦æ¸²æŸ“çš„å†…å®¹æ”¾åˆ° route ä¸­ï¼Œchildren å¦‚æœæ˜¯å‡½æ•°ä¹Ÿä¼šè¿›è¡Œæ¸²æŸ“,component æŒ‡çš„æ˜¯é€šé€š route çš„ component å±æ€§æ¥æŒ‡å®šè¦æ¸²æŸ“çš„ç»„ä»¶ï¼Œä¹Ÿå¯ä»¥åœ¨è¿™é‡Œé¢ä½¿ç”¨åŒ¿åå‡½æ•°ï¼Œrender æ˜¯æŒ‡é€šè¿‡ route é‡Œçš„ render æ¥è¿›è¡Œæ¸²æŸ“

ç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯é€šè¿‡ component æ¥è¿›è¡Œæ¸²æŸ“å¸ˆï¼Œæ˜¯é€šè¿‡ reac.createElement æ¥åˆ›å»ºçš„ï¼Œ è¿™ä¼šå¯¼è‡´ä¸å†æ›´æ–°ç°æœ‰ç»„ä»¶ï¼Œè€Œæ˜¯ç›´æ¥å¸è½½å†å»æŒ‚è½½ä¸€ä¸ªæ–°çš„ç»„ä»¶ï¼Œå¦‚æœæ˜¯ä½¿ç”¨åŒ¿åå‡½æ•°æ¥ä¼ å…¥ component ï¼Œæ¯æ¬¡ render çš„æ—¶å€™ï¼Œè¿™ä¸ª props éƒ½ä¸åŒï¼Œä¼šå¯¼è‡´é‡æ–°æ¸²æŸ“æŒ‚è½½ç»„ä»¶ï¼Œå¯¼è‡´æ€§èƒ½ç‰¹åˆ«å·®ã€‚å› æ­¤ï¼Œå½“ä½¿ç”¨åŒ¿åå‡½æ•°çš„æ¸²æŸ“æ—¶ï¼Œè¯·ä½¿ç”¨ render æˆ– children

```js
//react-router/route.js

<RouterContext.Provider value={props}>
  {props.match
    ? children
      ? typeof children === "function"
        ? __DEV__
          ? evalChildrenDev(children, props, this.props.path)
          : children(props)
        : children
      : component
      ? React.createElement(component, props)
      : render
      ? render(props)
      : null
    : typeof children === "function"
    ? __DEV__
      ? evalChildrenDev(children, props, this.props.path)
      : children(props)
    : null}
</RouterContext.Provider>
```

å…³äºç¬¬ä¸‰æ­¥æ¸²æŸ“å¯¹åº”çš„ç»„ä»¶æœ‰ä¸‰ç§å½¢å¼,ä¸Šé¢å·²ç»è¯´è¿‡

## æºç åˆ’åˆ†

react-router ä¸­çš„æºç ä¸»è¦æœ‰ä¸‰ç§è·¯ç”±ï¼Œåˆ†åˆ«æ˜¯ BrowserRouter,HashRouter,Native è·¯ç”±ï¼Œå…¶ä¸­å‰ä¸¤ä¸ªéƒ½åœ¨ react-router-dom ä¸­ï¼Œä¸»è¦é’ˆå¯¹æµè§ˆå™¨ä¸­çš„è·¯ç”±ï¼Œç¬¬ä¸‰ç§ä¸»è¦é’ˆå¯¹ react-native ä¸­çš„è·¯ç”±

å…ˆæ¥è¯´è¯´æµè§ˆå™¨ä¸­çš„è·¯ç”±

```js
import { Router } from "react-router";
import { createHashHistory as createHistory } from "history";
//...
class BrowserRouter extends React.Component {
  history = createHistory(this.props);

  render() {
    return <Router history={this.history} children={this.props.children} />;
  }
}
//,,,
```

```js
//...
class HashRouter extends React.Component {
  history = createHistory(this.props);

  render() {
    return <Router history={this.history} children={this.props.children} />;
  }
}
//...
```

é€šè¿‡å°† history ä¸­å¼•å…¥çš„å¯¹åº”è·¯ç”±æ”¾è¿› react-router çš„ history ä¸­æ¥å®ç°ä¸åŒçš„è·¯ç”±ï¼Œreact-router ä¸­çš„ router ä¸»è¦åšçš„å°±æ˜¯ç›‘å¬è·¯å¾„çš„å˜åŒ–

ç„¶åæ˜¯ Native ä¸­çš„

```js
//react-router-native
import { MemoryRouter } from "react-router";
function NativeRouter(props) {
  return <MemoryRouter {...props} />;
}
```

```js
import { createMemoryHistory as createHistory } from "history";
//...
class MemoryRouter extends React.Component {
  history = createHistory(this.props);

  render() {
    return <Router history={this.history} children={this.props.children} />;
  }
}
//...
```

å¯ä»¥çœ‹åˆ°æœ¬è´¨è¿˜æ˜¯é‚£æ ·ï¼Œæœ‰`<Route />` ,å°† history ä¸­çš„ä¸œè¥¿ä¼ åˆ° router çš„ history ä¸­

## context-Api

åœ¨ä¸Šé¢å¯ä»¥çœ‹åˆ° react-routee ä¸­çš„æœ‰`RouterContext.Provider`,å®ƒå¯¹åº”è¿˜æœ‰`RouterContext.Consumer`

è¿™ä¸ªä¸œè¥¿æ˜¯ç”±`createNameContext`åˆ›å»ºçš„ï¼Œä¸‹é¢æ˜¯ä»–çš„å®Œæ•´ä»£ç 

```js
import createNamedContext from "./createNameContext";

const context = /*#__PURE__*/ createNamedContext("Router");
export default context;
```

```js
import createNamedContext from "./createNameContext";

const historyContext = /*#__PURE__*/ createNamedContext("Router-History");
export default historyContext;
```

```js
// packages\react-router\modules\createNameContext.js
// TODO: Replace with React.createContext once we can assume React 16+
import createContext from "mini-create-react-context";

const createNamedContext = (name) => {
  const context = createContext();
  context.displayName = name;

  return context;
};

export default createNamedContext;
```

å¯ä»¥çœ‹åˆ°æ˜¯é€šè¿‡`mini-create-react-context`æ¥æçš„

å…ˆæ¥æ‰¾ä¸€ä¸‹`RouterContext`ç”Ÿäº§è€…åœ¨ä»€ä¹ˆåœ°æ–¹

```js
//react-router/router.js
 render() {
    return (
      <RouterContext.Provider
        value={{
          history: this.props.history, // è¿™é‡Œæœ‰å‰é¢é€šè¿‡historyåˆ›å»ºçš„è·¯ç”±
          location: this.state.location,
          match: Router.computeRootMatch(this.state.location.pathname),
          staticContext: this.props.staticContext
        }}
      >
        <HistoryContext.Provider
          children={this.props.children || null}
          value={this.props.history}
        />
      </RouterContext.Provider>
    );
  }
}
```

```js
//react-router/route.js
render() {
    return (
      <RouterContext.Consumer>
        {context => {
          invariant(context, "You should not use <Route> outside a <Router>");

          const location = this.props.location || context.location;
          const match = this.props.computedMatch
            ? this.props.computedMatch // <Switch> already computed the match for us
            : this.props.path
            ? matchPath(location.pathname, this.props)
            : context.match;

          const props = { ...context, location, match };

          let { children, component, render } = this.props;

          // Preact uses an empty array as children by
          // default, so use null if that's the case.
          if (Array.isArray(children) && isEmptyChildren(children)) {
            children = null;
          }

          return (
            <RouterContext.Provider value={props}>
            {/*ä¸‹é¢æœ‰è·¯å¾„åŒ¹é…çš„ä¼˜å…ˆçº§*/}
              {props.match
                ? children
                  ? typeof children === "function"
                    ? __DEV__
                      ? evalChildrenDev(children, props, this.props.path)
                      : children(props)
                    : children
                  : component
                  ? React.createElement(component, props)
                  : render
                  ? render(props)
                  : null
                : typeof children === "function"
                ? __DEV__
                  ? evalChildrenDev(children, props, this.props.path)
                  : children(props)
                : null}
            </RouterContext.Provider>
          );
        }}
      </RouterContext.Consumer>
    );
  }
}
```

ä¸Šé¢é‚£ä¸€æ®µä»£ç ä¹Ÿæœ‰æ¶ˆè´¹è€…

è¿˜æœ‰çš„æ¶ˆè´¹æ˜¯åœ¨

```js
//react-router/withRouter.js
return (
  <RouterContext.Consumer>
    {(context) => {
      invariant(
        context,
        `You should not use <${displayName} /> outside a <Router>`
      );
      return (
        <Component {...remainingProps} {...context} ref={wrappedComponentRef} />
      );
    }}
  </RouterContext.Consumer>
);
```

**`packages\react-router-dom\modules\Link.js`å’Œ`packages\react-router-dom\modules\NavLink.js`ä¸­ä¹Ÿæœ‰æ¶ˆè´¹è€…**

è¿˜æœ‰ä¸€ä¸ª`react-router-native`ä¸­çš„`HistoryContext`çš„æ¶ˆè´¹è€…

```js
//packages\react-router-native\BackButton.js
//packages\react-router-native\DeepLinking.js

 render() {
    return (
      <HistoryContext.Consumer>
        {history => {
          this.history = history;
          return this.props.children || null;
        }}
      </HistoryContext.Consumer>
    );
  }
```

```js
// packages\react-router-native\Link.js
render() {
const { component: Component, to, replace, ...rest } = this.props;

return (
    <HistoryContext.Consumer>
    {history => (
        <Component
        {...rest}
        onPress={event => this.handlePress(event, history)}
        />
    )}
    </HistoryContext.Consumer>
);
}
```

ä»åŠŸèƒ½è§’åº¦ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ React Router çš„ç»„ä»¶åˆ†ä¸ºä¸‰ç±»ï¼š

1. Context å®¹å™¨ï¼Œåˆ†åˆ«æ˜¯ Router ä¸ MemoryRouterï¼Œä¸»è¦æä¾›ä¸Šä¸‹æ–‡æ¶ˆè´¹å®¹å™¨ï¼›
2. ç›´æ¥æ¶ˆè´¹è€…ï¼Œæä¾›è·¯ç”±åŒ¹é…åŠŸèƒ½ï¼Œåˆ†åˆ«æ˜¯ Routeã€Redirectã€Switchï¼›
3. ä¸å¹³å°å…³è”çš„åŠŸèƒ½ç»„ä»¶ï¼Œåˆ†åˆ«æ˜¯ react-router-dom ä¸­çš„ Linkã€NavLink ä»¥åŠ react-router-native ä¸­çš„ DeepLinkingã€‚

## history

ä¸Šé¢å¤šæ¬¡æåˆ° historyï¼Œä»–æ˜¯ä¸€ä¸ªå•ç‹¬çš„åº“

ä¸»è¦é€»è¾‘åœ¨`index.ts`ä¸­çš„

[createHashHistory](https://github.com/ReactTraining/history/blob/master/packages/history/index.ts#L616)

[createBrowserHistory](https://github.com/ReactTraining/history/blob/master/packages/history/index.ts#L397)

[createMemoryHistory](https://github.com/ReactTraining/history/blob/master/packages/history/index.ts#L882)
