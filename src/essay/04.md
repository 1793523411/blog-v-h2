---
time: 2021-02-22
icon: template
category: é¢è¯•
article: false
sidebar: auto
footer: ğŸ˜ğŸ˜ğŸ˜
tag:
  - å‰ç«¯
  - JavaScript
---

# Front-end interview-prototype and prototype chain

## ä»€ä¹ˆæ˜¯åŸå‹

åŸå‹æ˜¯ JavaScript çš„é‡è¦ç‰¹æ€§ä¹‹ä¸€ï¼Œå¯ä»¥è®©å¯¹è±¡ä»å…¶ä»–å¯¹è±¡ç»§æ‰¿åŠŸèƒ½ç‰¹æ€§ï¼Œæ‰€ä»¥ JavaScript ä¹Ÿè¢«ç§°ä¸ºâ€œåŸºäºåŸå‹çš„è¯­è¨€â€ã€‚

ä¸¥æ ¼åœ°è¯´ï¼ŒåŸå‹åº”è¯¥æ˜¯å¯¹è±¡çš„ç‰¹æ€§ï¼Œä½†å‡½æ•°å…¶å®ä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯¹è‡ªå®šä¹‰çš„å‡½æ•°è¿›è¡Œ instanceof Object æ“ä½œæ—¶ï¼Œå…¶ç»“æœæ˜¯ true

```js
function fn() {}

fn instanceof Object; // true
```

### åŸå‹ä¸æ„é€ å‡½æ•°

åœ¨ js ä¸­æˆ‘ä»¬æ˜¯ä½¿ç”¨æ„é€ å‡½æ•°æ¥æ–°å»ºä¸€ä¸ªå¯¹è±¡çš„ï¼Œæ¯ä¸€ä¸ªæ„é€ å‡½æ•°çš„å†…éƒ¨éƒ½æœ‰ä¸€ä¸ª prototype å±æ€§å€¼ï¼Œè¿™ä¸ªå±æ€§å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«äº†å¯ä»¥ç”±è¯¥æ„é€ å‡½æ•°çš„æ‰€æœ‰å®ä¾‹å…±äº«çš„å±æ€§å’Œæ–¹æ³•ã€‚

å½“æˆ‘ä»¬ä½¿ç”¨æ„é€ å‡½æ•°æ–°å»ºä¸€ä¸ªå¯¹è±¡åï¼Œåœ¨è¿™ä¸ªå¯¹è±¡çš„å†…éƒ¨å°†åŒ…å«ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘æ„é€ å‡½æ•°çš„ prototype å±æ€§å¯¹åº”çš„å€¼ï¼Œåœ¨ ES5 ä¸­è¿™ä¸ªæŒ‡é’ˆè¢«ç§°ä¸ºå¯¹è±¡çš„åŸå‹ã€‚ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬æ˜¯ä¸åº”è¯¥èƒ½å¤Ÿè·å–åˆ°è¿™ä¸ªå€¼çš„ï¼Œä½†æ˜¯ç°åœ¨æµè§ˆå™¨ä¸­éƒ½å®ç°äº† `__proto__` å±æ€§æ¥è®©æˆ‘ä»¬è®¿é—®è¿™ä¸ªå±æ€§ï¼Œä½†æ˜¯æˆ‘ä»¬æœ€å¥½ä¸è¦ä½¿ç”¨è¿™ä¸ªå±æ€§ï¼Œå› ä¸ºå®ƒä¸æ˜¯è§„èŒƒä¸­è§„å®šçš„ã€‚

ES5 ä¸­æ–°å¢äº†ä¸€ä¸ª Object.getPrototypeOf() æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥è·å–å¯¹è±¡çš„åŸå‹ã€‚å½“æˆ‘ä»¬è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ—¶ï¼Œå¦‚æœè¿™ä¸ªå¯¹è±¡å†…éƒ¨ä¸å­˜åœ¨è¿™ä¸ªå±æ€§ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šå»å®ƒçš„åŸå‹å¯¹è±¡é‡Œæ‰¾è¿™ä¸ªå±æ€§ï¼Œè¿™ä¸ªåŸå‹å¯¹è±¡åˆä¼šæœ‰è‡ªå·±çš„åŸå‹ï¼Œäºæ˜¯å°±è¿™æ ·ä¸€ç›´æ‰¾ä¸‹å»ï¼Œä¹Ÿå°±æ˜¯åŸå‹é“¾çš„æ¦‚å¿µã€‚åŸå‹é“¾çš„å°½å¤´ä¸€èˆ¬æ¥è¯´éƒ½æ˜¯ Object.prototype æ‰€ä»¥è¿™å°±æ˜¯æˆ‘ä»¬æ–°å»ºçš„å¯¹è±¡ä¸ºä»€ä¹ˆèƒ½å¤Ÿä½¿ç”¨ toString()ç­‰æ–¹æ³•çš„åŸå› ã€‚

::: tip è·å–åŸå‹çš„æ–¹æ³•

å‡å¦‚ p æ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œp è·å–åŸå‹çš„æ–¹æ³•å¦‚ä¸‹ä¸‰ç§

å…¶ä¸­ obj.constructor æŒ‡å‘æ„é€ å‡½æ•°

```
obj.__proto__
obj.constructor.prototype
Object.getPrototypeOf(obj)
```

```js
function a() {
  this.a = 1;
  this.b = 2;
}

let obj = new a();

console.log(obj);

console.log(obj.constructor === a.prototype.constructor); //true

console.log(obj.constructor.prototype === a.prototype); //true

console.log(a.prototype.constructor.prototype === a.prototype); //true

console.log(a.prototype.isPrototypeOf(obj)); // true
```

:::

::: tip
JavaScript å¯¹è±¡æ˜¯é€šè¿‡å¼•ç”¨æ¥ä¼ é€’çš„ï¼Œæˆ‘ä»¬åˆ›å»ºçš„æ¯ä¸ªæ–°å¯¹è±¡å®ä½“ä¸­å¹¶æ²¡æœ‰ä¸€ä»½å±äºè‡ªå·±çš„åŸå‹å‰¯æœ¬ã€‚å½“æˆ‘ä»¬ä¿®æ”¹åŸå‹æ—¶ï¼Œä¸ä¹‹ç›¸å…³çš„å¯¹è±¡ä¹Ÿä¼šç»§æ‰¿è¿™ä¸€æ”¹å˜ã€‚
:::

::: tip

æµè§ˆå™¨ä¸­éƒ½å®ç°äº† `__proto__` å±æ€§æ¥è®©æˆ‘ä»¬è®¿é—®`[[Prototype]]`çš„å€¼ï¼Œä½†æ˜¯æˆ‘ä»¬æœ€å¥½ä¸è¦ä½¿ç”¨è¿™ä¸ªå±æ€§ï¼Œå› ä¸ºå®ƒä¸æ˜¯è§„èŒƒä¸­è§„å®šçš„

è™½ç„¶æˆ‘ä»¬åœ¨è„šæœ¬ä¸­æ²¡æœ‰åŠæ³•è®¿é—®åˆ°`[[Prototype]]`å±æ€§ï¼Œä½†æ˜¯`isPrototypeOf()` æ–¹æ³•ç”¨äºæµ‹è¯•ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å­˜åœ¨äºå¦ä¸€ä¸ªå¯¹è±¡çš„åŸå‹é“¾ä¸Šã€‚

åœ¨ ECMAScript 5 ä¸­æ–°å¢äº†ä¸€ä¸ªæ–¹æ³•å« `Object.getPrototypeOf()` ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥è¿”å›`[[Prototype]]`çš„å€¼
:::

### éšå¼åŸå‹å’Œæ˜¾å¼åŸå‹

éšå¼åŸå‹é€šå¸¸åœ¨åˆ›å»ºå®ä¾‹çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨æŒ‡å‘æ„é€ å‡½æ•°çš„æ˜¾å¼åŸå‹ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œå½“åˆ›å»ºå¯¹è±¡ a æ—¶ï¼Œa çš„éšå¼åŸå‹ä¼šæŒ‡å‘æ„é€ å‡½æ•° Object() çš„æ˜¾å¼åŸå‹

```js
var a = {};
a.__proto__ === Object.prototype; // true
var b = new Object();
b.__proto__ === a.__proto__; // true
```

æ˜¾å¼åŸå‹æ˜¯å†…ç½®å‡½æ•°ï¼ˆæ¯”å¦‚ Date() å‡½æ•°ï¼‰çš„é»˜è®¤å±æ€§ï¼Œåœ¨è‡ªå®šä¹‰å‡½æ•°æ—¶ï¼ˆç®­å¤´å‡½æ•°é™¤å¤–ï¼‰ä¹Ÿä¼šé»˜è®¤ç”Ÿæˆï¼Œç”Ÿæˆçš„æ˜¾å¼åŸå‹å¯¹è±¡åªæœ‰ä¸€ä¸ªå±æ€§ constructor ï¼Œè¯¥å±æ€§æŒ‡å‘å‡½æ•°è‡ªèº«ã€‚é€šå¸¸é…åˆ new å…³é”®å­—ä¸€èµ·ä½¿ç”¨ï¼Œå½“é€šè¿‡ new å…³é”®å­—åˆ›å»ºå‡½æ•°å®ä¾‹æ—¶ï¼Œä¼šå°†å®ä¾‹çš„éšå¼åŸå‹æŒ‡å‘æ„é€ å‡½æ•°çš„æ˜¾å¼åŸå‹

```js
function fn() {}
fn.prototype.constructor === fn; // true
```

::: tip éšå¼åŸå‹æ˜¯å¦å¿…é¡»ä¸æ˜¾å¼åŸå‹é…åˆä½¿ç”¨å‘¢ï¼Ÿ

ä¸‹é¢çš„ä»£ç å£°æ˜äº† parent å’Œ child ä¸¤ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­å¯¹è±¡ child å®šä¹‰äº†å±æ€§ name å’Œéšå¼åŸå‹ protoï¼Œéšå¼åŸå‹æŒ‡å‘å¯¹è±¡ parentï¼Œå¯¹è±¡ parent å®šä¹‰äº† code å’Œ name ä¸¤ä¸ªå±æ€§ã€‚

å½“æ‰“å° child.name çš„æ—¶å€™ä¼šè¾“å‡ºå¯¹è±¡ child çš„ name å±æ€§å€¼ï¼Œå½“æ‰“å° child.code æ—¶ç”±äºå¯¹è±¡ child æ²¡æœ‰å±æ€§ codeï¼Œæ‰€ä»¥ä¼šæ‰¾åˆ°åŸå‹å¯¹è±¡ parent çš„å±æ€§ codeï¼Œå°† parent.code çš„å€¼æ‰“å°å‡ºæ¥ã€‚åŒæ—¶å¯ä»¥é€šè¿‡æ‰“å°ç»“æœçœ‹åˆ°ï¼Œå¯¹è±¡ parent å¹¶æ²¡æœ‰æ˜¾å¼åŸå‹å±æ€§ã€‚å¦‚æœè¦åŒºåˆ†å¯¹è±¡ child çš„å±æ€§æ˜¯å¦ç»§æ‰¿è‡ªåŸå‹å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡ hasOwnProperty() å‡½æ•°æ¥åˆ¤æ–­

```js
var parent = { code: "p", name: "parent" };
var child = { __proto__: parent, name: "child" };
console.log(parent.prototype); // undefined
console.log(child.name); // "child"
console.log(child.code); // "p"
child.hasOwnProperty("name"); // true
child.hasOwnProperty("code"); // false
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœå¯¹è±¡ parent ä¹Ÿæ²¡æœ‰å±æ€§ codeï¼Œé‚£ä¹ˆä¼šç»§ç»­åœ¨å¯¹è±¡ parent çš„åŸå‹å¯¹è±¡ä¸­å¯»æ‰¾å±æ€§ codeï¼Œä»¥æ­¤ç±»æ¨ï¼Œé€ä¸ªåŸå‹å¯¹è±¡ä¾æ¬¡è¿›è¡ŒæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°å±æ€§ code æˆ–åŸå‹å¯¹è±¡æ²¡æœ‰æŒ‡å‘æ—¶åœæ­¢ã€‚

è¿™ç§ç±»ä¼¼é€’å½’çš„é“¾å¼æŸ¥æ‰¾æœºåˆ¶è¢«ç§°ä½œâ€œåŸå‹é“¾â€

:::

### åŸå‹çš„å±æ€§

**å±æ€§çš„è®¿é—®**

æ¯å½“ä»£ç è¯»å–å¯¹è±¡çš„æŸä¸ªå±æ€§æ—¶ï¼Œé¦–å…ˆä¼šåœ¨å¯¹è±¡æœ¬èº«æœç´¢è¿™ä¸ªå±æ€§ï¼Œå¦‚æœæ‰¾åˆ°è¯¥å±æ€§å°±è¿”å›è¯¥å±æ€§çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ç»§ç»­æœç´¢è¯¥å¯¹è±¡å¯¹åº”çš„åŸå‹å¯¹è±¡ï¼Œä»¥æ­¤ç±»æ¨ä¸‹å»ã€‚

å› ä¸ºè¿™æ ·çš„æœç´¢è¿‡ç¨‹ï¼Œå› æ­¤æˆ‘ä»¬å¦‚æœåœ¨å®ä¾‹ä¸­æ·»åŠ ä¸€ä¸ªå±æ€§æ—¶ï¼Œè¿™ä¸ªå±æ€§å°±ä¼šå±è”½åŸå‹å¯¹è±¡ä¸­ä¿å­˜çš„åŒåå±æ€§ï¼Œå› ä¸ºåœ¨å®ä¾‹ä¸­æœç´¢åˆ°è¯¥å±æ€§åå°±ä¸ä¼šå†å‘åæœç´¢äº†

**å±æ€§åˆ¤æ–­**

æ—¢ç„¶ä¸€ä¸ªå±æ€§æ—¢å¯èƒ½æ˜¯å®ä¾‹æœ¬èº«çš„ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å…¶åŸå‹å¯¹è±¡çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•æ¥åˆ¤æ–­å‘¢ï¼Ÿ

ç­”ï¼šä½¿ç”¨ hasOwnProperty()

::: tip Javascript ä¸­ï¼Œæœ‰ä¸€ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œæ—¶å¯¹è±¡æŸ¥æ‰¾æ—¶ï¼Œæ°¸è¿œä¸ä¼šå»æŸ¥æ‰¾åŸå‹
hasOwnProperty æ‰€æœ‰ç»§æ‰¿äº† Object çš„å¯¹è±¡éƒ½ä¼šç»§æ‰¿åˆ° hasOwnProperty æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥ç”¨æ¥æ£€æµ‹ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å«æœ‰ç‰¹å®šçš„è‡ªèº«å±æ€§ï¼Œå’Œ in è¿ç®—ç¬¦ä¸åŒï¼Œè¯¥æ–¹æ³•ä¼šå¿½ç•¥æ‰é‚£äº›ä»åŸå‹é“¾ä¸Šç»§æ‰¿åˆ°çš„å±æ€§ã€‚
:::

åœ¨ä½¿ç”¨ `for-in` å¾ªç¯æ—¶ï¼Œè¿”å›çš„æ˜¯æ‰€æœ‰èƒ½**å¤Ÿé€šè¿‡å¯¹è±¡è®¿é—®çš„ã€å¯æšä¸¾çš„å±æ€§**ï¼Œå…¶ä¸­åŒ…æ‹¬äº†å­˜åœ¨äºå®ä¾‹ä¸­çš„å±æ€§ï¼Œä¹ŸåŒ…æ‹¬äº†å­˜åœ¨äºåŸå‹ä¸­çš„å±æ€§ã€‚

éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå±è”½äº†å®ä¾‹ä¸­ä¸å¯æšä¸¾å±æ€§çš„å®ä¾‹å±æ€§ä¹Ÿä¼šåœ¨ `for-in` å¾ªç¯ä¸­è¿”å›ã€‚

::: tip

å› æ­¤æˆ‘ä»¬å¯ä»¥å°è£…è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼Œæ¥åˆ¤æ–­ä¸€ä¸ªå±æ€§æ˜¯å¦å­˜åœ¨äºåŸå‹ä¸­

```js
function hasPrototypeProperty(object, name) {
  return !object.hasOwnProperty(name) && name in object;
}
```

:::

**è·å–æ‰€æœ‰å±æ€§**

å¦‚æœæƒ³è¦è·å¾—å¯¹è±¡ä¸Šæ‰€æœ‰**å¯æšä¸¾**çš„å®ä¾‹å±æ€§ï¼Œå¯ä»¥ä½¿ç”¨ `Object.keys()` æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å¯æšä¸¾å±æ€§çš„å­—ç¬¦ä¸²æ•°ç»„ã€‚

å¦‚æœæƒ³è¦è·å–æ‰€æœ‰çš„å®ä¾‹å±æ€§ï¼Œæ— è®ºå®ƒæ˜¯å¦å¯ä»¥æšä¸¾ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `Object.getOwnPropertyNames()` æ–¹æ³•

## ä»€ä¹ˆåŸå‹é“¾

é€šè¿‡ä¸€ä¸ªå¯¹è±¡çš„ proto å¯ä»¥æ‰¾åˆ°å®ƒçš„åŸå‹å¯¹è±¡ï¼ŒåŸå‹å¯¹è±¡ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°±å¯ä»¥é€šè¿‡åŸå‹å¯¹è±¡çš„ `__proto__`ï¼Œæœ€åæ‰¾åˆ°äº†æˆ‘ä»¬çš„ Object.prototype,ä»å®ä¾‹çš„åŸå‹å¯¹è±¡å¼€å§‹ä¸€ç›´åˆ° Object.prototype å°±æ˜¯æˆ‘ä»¬çš„åŸå‹é“¾

::: tip åœ¨ä»‹ç»åŸå‹æ—¶å°±å¼•å‡ºäº†åŸå‹é“¾çš„æ¦‚å¿µ

å…¶å®ä¸Šé¢å°†åŸå‹å°±å·²ç»åŒ…å«äº†è®¸å¤šåŸå‹é“¾çš„çŸ¥è¯†

å½“æˆ‘ä»¬è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ—¶ï¼Œå¦‚æœè¿™ä¸ªå¯¹è±¡å†…éƒ¨ä¸å­˜åœ¨è¿™ä¸ªå±æ€§ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šå»å®ƒçš„åŸå‹å¯¹è±¡é‡Œæ‰¾è¿™ä¸ªå±æ€§ï¼Œè¿™ä¸ªåŸå‹å¯¹è±¡åˆä¼šæœ‰è‡ªå·±çš„åŸå‹ï¼Œäºæ˜¯å°±è¿™æ ·ä¸€ç›´æ‰¾ä¸‹å»ï¼Œä¹Ÿå°±æ˜¯åŸå‹é“¾çš„æ¦‚å¿µã€‚åŸå‹é“¾çš„å°½å¤´ä¸€èˆ¬æ¥è¯´éƒ½æ˜¯ Object.prototype æ‰€ä»¥è¿™å°±æ˜¯æˆ‘ä»¬æ–°å»ºçš„å¯¹è±¡ä¸ºä»€ä¹ˆèƒ½å¤Ÿä½¿ç”¨ toString()ç­‰æ–¹æ³•çš„åŸå› 

è¿™ç§ç±»ä¼¼é€’å½’çš„é“¾å¼æŸ¥æ‰¾æœºåˆ¶è¢«ç§°ä½œâ€œåŸå‹é“¾â€
:::

## æ¡ˆä¾‹

### åœ¨ Array æœ¬åœ°å¯¹è±¡ä¸ŠåŠ åŸå‹æ–¹æ³•

ç”¨é€”æ˜¯å»é‡å‡åºæ’åºï¼Œæœ€åè¿”å›æ–°æ•°ç»„

```js
Array.prototype.distinct = function() {
  return [...new Set(this)].sort((a, b) => a - b);
};
console.log(["a", "b", "c", "d", "b", "a", "e"].distinct()); // ["a", "b"]
```

### é€šè¿‡åŸå‹é“¾å®ç°å¤šå±‚ç»§æ‰¿

å‡è®¾æ„é€ å‡½æ•° B() éœ€è¦ç»§æ‰¿æ„é€ å‡½æ•° A()ï¼Œå°±å¯ä»¥é€šè¿‡å°†å‡½æ•° B() çš„æ˜¾å¼åŸå‹æŒ‡å‘ä¸€ä¸ªå‡½æ•° A() çš„å®ä¾‹ï¼Œç„¶åå†å¯¹ B çš„æ˜¾å¼åŸå‹è¿›è¡Œæ‰©å±•ã€‚é‚£ä¹ˆé€šè¿‡å‡½æ•° B() åˆ›å»ºçš„å®ä¾‹ï¼Œæ—¢èƒ½è®¿é—®ç”¨å‡½æ•° B() çš„å±æ€§ bï¼Œä¹Ÿèƒ½è®¿é—®å‡½æ•° A() çš„å±æ€§ aï¼Œä»è€Œå®ç°äº†å¤šå±‚ç»§æ‰¿ã€‚

```js
function A() {}

A.prototype.a = function() {
  return "a";
};

function B() {}

B.prototype = new A();

B.prototype.b = function() {
  return "b";
};

var c = new B();

c.b(); // 'b'

c.a(); // 'a'
```

### å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡

```js
function Foo(who) {
  this.me = who;
}

Foo.prototype.identify = function() {
  return "I am " + this.me;
};

function Bar(who) {
  Foo.call(this, who);
}

Bar.prototype = Object.create(Foo.prototype);

Bar.prototype.speak = function() {
  alert("Hello, " + this.identify() + ".");
};

var b1 = new Bar("b1");
var b2 = new Bar("b2");

b1.speak(); //Hello, I am b1
b2.speak(); //Hello, I am b2
```
