---
time: 2021-02-27
icon: template
category: é¢è¯•
article: true
sidebar: auto
footer: ğŸ˜ğŸ˜ğŸ˜
tag:
  - å‰ç«¯
  - css
---

# å‰ç«¯é¢è¯•-å¼‚æ­¥

## åŒæ­¥ä¸å¼‚æ­¥

æ‰€è°“çš„åŒæ­¥å°±æ˜¯åœ¨æ‰§è¡ŒæŸæ®µä»£ç æ—¶ï¼Œåœ¨è¯¥ä»£ç æ²¡æœ‰å¾—åˆ°è¿”å›ç»“æœä¹‹å‰ï¼Œå…¶ä»–ä»£ç æš‚æ—¶æ˜¯æ— æ³•æ‰§è¡Œçš„ï¼Œä½†æ˜¯ä¸€æ—¦æ‰§è¡Œå®Œæˆæ‹¿åˆ°è¿”å›å€¼ä¹‹åï¼Œå°±å¯ä»¥æ‰§è¡Œå…¶ä»–ä»£ç äº†ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨æ­¤æ®µä»£ç æ‰§è¡Œå®Œæœªè¿”å›ç»“æœä¹‹å‰ï¼Œä¼šé˜»å¡ä¹‹åçš„ä»£ç æ‰§è¡Œï¼Œè¿™æ ·çš„æƒ…å†µç§°ä¸ºåŒæ­¥

æ‰€è°“å¼‚æ­¥å°±æ˜¯å½“æŸä¸€ä»£ç æ‰§è¡Œå¼‚æ­¥è¿‡ç¨‹è°ƒç”¨å‘å‡ºåï¼Œè¿™æ®µä»£ç ä¸ä¼šç«‹åˆ»å¾—åˆ°è¿”å›ç»“æœã€‚è€Œæ˜¯åœ¨å¼‚æ­¥è°ƒç”¨å‘å‡ºä¹‹åï¼Œä¸€èˆ¬é€šè¿‡å›è°ƒå‡½æ•°å¤„ç†è¿™ä¸ªè°ƒç”¨ä¹‹åæ‹¿åˆ°ç»“æœã€‚å¼‚æ­¥è°ƒç”¨å‘å‡ºåï¼Œä¸ä¼šå½±å“é˜»å¡åé¢çš„ä»£ç æ‰§è¡Œï¼Œè¿™æ ·çš„æƒ…å½¢ç§°ä¸ºå¼‚æ­¥ã€‚

### why

JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼Œå¦‚æœ JS éƒ½æ˜¯åŒæ­¥ä»£ç æ‰§è¡Œæ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿè¿™æ ·å¯èƒ½ä¼šé€ æˆé˜»å¡ï¼Œå¦‚æœå½“å‰æˆ‘ä»¬æœ‰ä¸€æ®µä»£ç éœ€è¦æ‰§è¡Œæ—¶ï¼Œå¦‚æœä½¿ç”¨åŒæ­¥çš„æ–¹å¼ï¼Œé‚£ä¹ˆå°±ä¼šé˜»å¡åé¢çš„ä»£ç æ‰§è¡Œï¼›è€Œå¦‚æœä½¿ç”¨å¼‚æ­¥åˆ™ä¸ä¼šé˜»å¡ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç­‰å¾…å¼‚æ­¥ä»£ç æ‰§è¡Œçš„è¿”å›ç»“æœï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œè¯¥å¼‚æ­¥ä»»åŠ¡ä¹‹åçš„ä»£ç é€»è¾‘ã€‚å› æ­¤åœ¨ JS ç¼–ç¨‹ä¸­ï¼Œä¼šå¤§é‡ä½¿ç”¨å¼‚æ­¥æ¥è¿›è¡Œç¼–ç¨‹

### å¼‚æ­¥çš„å‘å±•

```
å›è°ƒå‡½æ•°--> Promise--> Generator-->async/await
```

### å›è°ƒå‡½æ•°

æ—©äº›å¹´ä¸ºäº†å®ç° JS çš„å¼‚æ­¥ç¼–ç¨‹ï¼Œä¸€èˆ¬éƒ½é‡‡ç”¨å›è°ƒå‡½æ•°çš„æ–¹å¼ï¼Œæ¯”å¦‚æ¯”è¾ƒå…¸å‹çš„äº‹ä»¶çš„å›è°ƒï¼Œæˆ–è€…ç”¨ setTimeout/ setInterval æ¥å®ç°ä¸€äº›å¼‚æ­¥ç¼–ç¨‹çš„æ“ä½œï¼Œä½†æ˜¯ä½¿ç”¨å›è°ƒå‡½æ•°æ¥å®ç°å­˜åœ¨ä¸€ä¸ªå¾ˆå¸¸è§çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯å›è°ƒåœ°ç‹±

```js
fs.readFile(A, "utf-8", function(err, data) {
  fs.readFile(B, "utf-8", function(err, data) {
    fs.readFile(C, "utf-8", function(err, data) {
      fs.readFile(D, "utf-8", function(err, data) {
        //....
      });
    });
  });
});
```

å›è°ƒå®ç°å¼‚æ­¥ç¼–ç¨‹çš„åœºæ™¯ä¹Ÿæœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š

- ajax è¯·æ±‚çš„å›è°ƒï¼›
- å®šæ—¶å™¨ä¸­çš„å›è°ƒï¼›
- äº‹ä»¶å›è°ƒï¼›
- Nodejs ä¸­çš„ä¸€äº›æ–¹æ³•å›è°ƒã€‚

å¼‚æ­¥å›è°ƒå¦‚æœå±‚çº§å¾ˆå°‘ï¼Œå¯è¯»æ€§å’Œä»£ç çš„ç»´æŠ¤æ€§æš‚æ—¶è¿˜æ˜¯å¯ä»¥æ¥å—ï¼Œä¸€æ—¦å±‚çº§å˜å¤šå°±ä¼šé™·å…¥å›è°ƒåœ°ç‹±ï¼Œä¸Šé¢è¿™äº›å¼‚æ­¥ç¼–ç¨‹çš„åœºæ™¯éƒ½ä¼šæ¶‰åŠå›è°ƒåœ°ç‹±çš„é—®é¢˜

### Promise

ä¸ºäº†è§£å†³å›è°ƒåœ°ç‹±çš„é—®é¢˜ï¼Œä¹‹åç¤¾åŒºæå‡ºäº† Promise çš„è§£å†³æ–¹æ¡ˆï¼ŒES6 åˆå°†å…¶å†™è¿›äº†è¯­è¨€æ ‡å‡†ï¼Œé‡‡ç”¨ Promise çš„å®ç°æ–¹å¼åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†å›è°ƒåœ°ç‹±çš„é—®é¢˜

```js
function read(url) {
  return new Promise((resolve, reject) => {
    fs.readFile(url, "utf8", (err, data) => {
      if (err) reject(err);

      resolve(data);
    });
  });
}

read(A)
  .then((data) => {
    return read(B);
  })
  .then((data) => {
    return read(C);
  })
  .then((data) => {
    return read(D);
  })
  .catch((reason) => {
    console.log(reason);
  });
```

é’ˆå¯¹å›è°ƒåœ°ç‹±è¿›è¡Œè¿™æ ·çš„æ”¹è¿›ï¼Œå¯è¯»æ€§çš„ç¡®æœ‰ä¸€å®šçš„æå‡ï¼Œä¼˜ç‚¹æ˜¯å¯ä»¥å°†å¼‚æ­¥æ“ä½œä»¥åŒæ­¥æ“ä½œçš„æµç¨‹è¡¨è¾¾å‡ºæ¥ï¼Œé¿å…äº†å±‚å±‚åµŒå¥—çš„å›è°ƒå‡½æ•°ï¼Œä½†æ˜¯ Promise ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œå³ä¾¿æ˜¯ä½¿ç”¨ Promise çš„é“¾å¼è°ƒç”¨ï¼Œå¦‚æœæ“ä½œè¿‡å¤šï¼Œå…¶å®å¹¶æ²¡æœ‰ä»æ ¹æœ¬ä¸Šè§£å†³å›è°ƒåœ°ç‹±çš„é—®é¢˜ï¼Œåªæ˜¯æ¢äº†ä¸€ç§å†™æ³•ï¼Œå¯è¯»æ€§è™½ç„¶æœ‰æ‰€æå‡ï¼Œä½†æ˜¯ä¾æ—§å¾ˆéš¾ç»´æŠ¤ã€‚ä¸è¿‡ Promise åˆæä¾›äº†ä¸€ä¸ª all æ–¹æ³•ï¼Œå¯¹äºè¿™ä¸ªä¸šåŠ¡åœºæ™¯çš„ä»£ç ï¼Œç”¨ all æ¥å®ç°å¯èƒ½æ•ˆæœä¼šæ›´å¥½

```js
function read(url) {
  return new Promise((resolve, reject) => {
    fs.readFile(url, "utf8", (err, data) => {
      if (err) reject(err);

      resolve(data);
    });
  });
}

// é€šè¿‡ Promise.all å¯ä»¥å®ç°å¤šä¸ªå¼‚æ­¥å¹¶è¡Œæ‰§è¡Œï¼ŒåŒä¸€æ—¶åˆ»è·å–æœ€ç»ˆç»“æœçš„é—®é¢˜

Promise.all([read(A), read(B), read(C)])
  .then((data) => {
    console.log(data);
  })
  .catch((err) => console.log(err));
```

### Generator

Generator ä¹Ÿæ˜¯ä¸€ç§å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆï¼Œå®ƒæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å¯ä»¥äº¤å‡ºå‡½æ•°çš„æ‰§è¡Œæƒï¼ŒGenerator å‡½æ•°å¯ä»¥çœ‹å‡ºæ˜¯å¼‚æ­¥ä»»åŠ¡çš„å®¹å™¨ï¼Œéœ€è¦æš‚åœçš„åœ°æ–¹ï¼Œéƒ½ç”¨ yield è¯­æ³•æ¥æ ‡æ³¨ã€‚Generator å‡½æ•°ä¸€èˆ¬é…åˆ yield ä½¿ç”¨ï¼ŒGenerator å‡½æ•°æœ€åè¿”å›çš„æ˜¯è¿­ä»£å™¨

```js
function* gen() {
  let a = yield 111;
  console.log(a);
  let b = yield 222;
  console.log(b);
  let c = yield 333;
  console.log(c);
  let d = yield 444;
  console.log(d);
}

let t = gen();

t.next(1); //ç¬¬ä¸€æ¬¡è°ƒç”¨nextå‡½æ•°æ—¶ï¼Œä¼ é€’çš„å‚æ•°æ— æ•ˆï¼Œæ•…æ— æ‰“å°ç»“æœ
t.next(2); // aè¾“å‡º2;
t.next(3); // bè¾“å‡º3;
t.next(4); // cè¾“å‡º4;
t.next(5); // dè¾“å‡º5;
```

### async/await

ES6 ä¹‹å ES7 ä¸­åˆæå‡ºäº†æ–°çš„å¼‚æ­¥è§£å†³æ–¹æ¡ˆï¼šasync/awaitï¼Œasync æ˜¯ Generator å‡½æ•°çš„è¯­æ³•ç³–ï¼Œasync/await çš„ä¼˜ç‚¹æ˜¯ä»£ç æ¸…æ™°ï¼ˆä¸åƒä½¿ç”¨ Promise çš„æ—¶å€™éœ€è¦å†™å¾ˆå¤š then çš„æ–¹æ³•é“¾ï¼‰ï¼Œå¯ä»¥å¤„ç†å›è°ƒåœ°ç‹±çš„é—®é¢˜ã€‚async/await å†™èµ·æ¥ä½¿å¾— JS çš„å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒåŒæ­¥ä»£ç ï¼Œå…¶å®å¼‚æ­¥ç¼–ç¨‹å‘å±•çš„ç›®æ ‡å°±æ˜¯è®©å¼‚æ­¥é€»è¾‘çš„ä»£ç çœ‹èµ·æ¥åƒåŒæ­¥ä¸€æ ·å®¹æ˜“ç†è§£

```js
function testWait() {
  return new Promise((resolve, reject) => {
    setTimeout(function() {
      console.log("testWait");

      resolve();
    }, 1000);
  });
}

async function testAwaitUse() {
  await testWait();

  console.log("hello");

  return 123; // è¾“å‡ºé¡ºåºï¼štestWaitï¼Œhello // ç¬¬åè¡Œå¦‚æœä¸ä½¿ç”¨awaitè¾“å‡ºé¡ºåºï¼šhello , testWait
}

console.log(testAwaitUse());
```

æ‰§è¡Œä¸Šé¢çš„ä»£ç ï¼Œä»ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œåœ¨æ­£å¸¸çš„æ‰§è¡Œé¡ºåºä¸‹ï¼ŒtestWait è¿™ä¸ªå‡½æ•°ç”±äºä½¿ç”¨çš„æ˜¯ setTimeout çš„å®šæ—¶å™¨ï¼Œå›è°ƒä¼šåœ¨ä¸€ç§’ä¹‹åæ‰§è¡Œï¼Œä½†æ˜¯ç”±äºæ‰§è¡Œåˆ°è¿™é‡Œé‡‡ç”¨äº† await å…³é”®è¯ï¼ŒtestAwaitUse å‡½æ•°åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­éœ€è¦ç­‰å¾… testWait å‡½æ•°æ‰§è¡Œå®Œæˆä¹‹åï¼Œå†æ‰§è¡Œæ‰“å° hello çš„æ“ä½œã€‚ä½†æ˜¯å¦‚æœå»æ‰ await ï¼Œæ‰“å°ç»“æœçš„é¡ºåºå°±ä¼šå˜åŒ–ã€‚

å› æ­¤ï¼Œasync/await ä¸ä»…ä»…æ˜¯ JS çš„å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§æ–¹å¼ï¼Œå…¶å¯è¯»æ€§ä¹Ÿæ¥è¿‘äºåŒæ­¥ä»£ç ï¼Œè®©äººæ›´å®¹æ˜“ç†è§£ã€‚

::: tip å°ç»“

| js å¼‚æ­¥ç¼–ç¨‹æ–¹å¼ |                           ç®€å•æ€»ç»“                            |
| :-------------: | :-----------------------------------------------------------: |
|    å›è°ƒå‡½æ•°     |                 æ—©äº›å¹´ js å¼‚æ­¥ç¼–ç¨‹é‡‡ç”¨çš„æ–¹å¼                  |
|     Promise     |            ES6 æ–°å¢å¼‚æ­¥ç¼–ç¨‹æ–¹å¼ï¼Œè§£å†³å›è°ƒåœ°ç‹±é—®é¢˜             |
|    Generator    |               å’Œ yield é…åˆä½¿ç”¨ï¼Œè¿”å›çš„æ˜¯è¿­ä»£å™¨               |
|   async/await   | äºŒè€…é…åˆä½¿ç”¨ï¼Œasync è¿”å›çš„æ˜¯ Promise å¯¹è±¡ï¼Œawait æ§åˆ¶æ‰§è¡Œé¡ºåº |

:::

## Promise

### Promise ä»‹ç»

å¦‚æœä¸€å®šè¦è§£é‡Š Promise åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œç®€å•æ¥è¯´å®ƒå°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯å¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚ä»è¯­æ³•ä¸Šè¯´ï¼ŒPromise æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»å®ƒå¯ä»¥è·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚

Promise æä¾›ç»Ÿä¸€çš„ APIï¼Œå„ç§å¼‚æ­¥æ“ä½œéƒ½å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•è¿›è¡Œå¤„ç†

```js
function read(url) {
  return new Promise((resolve, reject) => {
    fs.readFile(url, "utf8", (err, data) => {
      if (err) reject(err);

      resolve(data);
    });
  });
}

read(A)
  .then((data) => {
    return read(B);
  })
  .then((data) => {
    return read(C);
  })
  .then((data) => {
    return read(D);
  })
  .catch((reason) => {
    console.log(reason);
  });
```

Promise å¯¹è±¡åœ¨è¢«åˆ›å»ºå‡ºæ¥æ—¶æ˜¯å¾…å®šçš„çŠ¶æ€ï¼Œå®ƒè®©ä½ èƒ½å¤ŸæŠŠå¼‚æ­¥æ“ä½œè¿”å›æœ€ç»ˆçš„æˆåŠŸå€¼æˆ–è€…å¤±è´¥åŸå› ï¼Œå’Œç›¸åº”çš„å¤„ç†ç¨‹åºå…³è”èµ·æ¥ã€‚

ä¸€èˆ¬ Promise åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¿…ç„¶ä¼šå¤„äºä»¥ä¸‹å‡ ç§çŠ¶æ€ä¹‹ä¸€ã€‚

- å¾…å®šï¼ˆpendingï¼‰ï¼šåˆå§‹çŠ¶æ€ï¼Œæ—¢æ²¡æœ‰è¢«å®Œæˆï¼Œä¹Ÿæ²¡æœ‰è¢«æ‹’ç»ã€‚
- å·²å®Œæˆï¼ˆfulfilledï¼‰ï¼šæ“ä½œæˆåŠŸå®Œæˆã€‚
- å·²æ‹’ç»ï¼ˆrejectedï¼‰ï¼šæ“ä½œå¤±è´¥ã€‚

å¾…å®šçŠ¶æ€çš„ Promise å¯¹è±¡æ‰§è¡Œçš„è¯ï¼Œæœ€åè¦ä¹ˆä¼šé€šè¿‡ä¸€ä¸ªå€¼å®Œæˆï¼Œè¦ä¹ˆä¼šé€šè¿‡ä¸€ä¸ªåŸå› è¢«æ‹’ç»ã€‚å½“å…¶ä¸­ä¸€ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬ç”¨ Promise çš„ then æ–¹æ³•æ’åˆ—èµ·æ¥çš„ç›¸å…³å¤„ç†ç¨‹åºå°±ä¼šè¢«è°ƒç”¨ã€‚å› ä¸ºæœ€å Promise.prototype.then å’Œ Promise.prototype.catch æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª Promiseï¼Œ æ‰€ä»¥å®ƒä»¬å¯ä»¥ç»§ç»­è¢«é“¾å¼è°ƒç”¨ã€‚

å…³äº Promise çš„çŠ¶æ€æµè½¬æƒ…å†µï¼Œæœ‰ä¸€ç‚¹å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå†…éƒ¨çŠ¶æ€æ”¹å˜ä¹‹åä¸å¯é€†

![](https://s0.lgstatic.com/i/image6/M01/05/09/Cgp9HWAvhIyAH1WgAAES_06spV4639.png)

### Promise å¦‚ä½•è§£å†³å›è°ƒåœ°ç‹±

å›è°ƒåœ°ç‹±æœ‰ä¸¤ä¸ªä¸»è¦çš„é—®é¢˜ï¼š

- å¤šå±‚åµŒå¥—çš„é—®é¢˜ï¼›
- æ¯ç§ä»»åŠ¡çš„å¤„ç†ç»“æœå­˜åœ¨ä¸¤ç§å¯èƒ½æ€§ï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰ï¼Œé‚£ä¹ˆéœ€è¦åœ¨æ¯ç§ä»»åŠ¡æ‰§è¡Œç»“æŸååˆ†åˆ«å¤„ç†è¿™ä¸¤ç§å¯èƒ½æ€§ã€‚

è¿™ä¸¤ç§é—®é¢˜åœ¨â€œå›è°ƒå‡½æ•°æ—¶ä»£â€å°¤ä¸ºçªå‡ºï¼ŒPromise çš„è¯ç”Ÿå°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ã€‚Promise åˆ©ç”¨äº†ä¸‰å¤§æŠ€æœ¯æ‰‹æ®µæ¥è§£å†³å›è°ƒåœ°ç‹±ï¼š**å›è°ƒå‡½æ•°å»¶è¿Ÿç»‘å®šã€è¿”å›å€¼ç©¿é€ã€é”™è¯¯å†’æ³¡**

```js
let readFilePromise = (filename) => {
  return new Promise((resolve, reject) => {
    fs.readFile(filename, (err, data) => {
      if (err) {
        reject(err);
      } else {
        resolve(data);
      }
    });
  });
};

readFilePromise("1.json").then((data) => {
  return readFilePromise("2.json");
});
```

ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå›è°ƒå‡½æ•°ä¸æ˜¯ç›´æ¥å£°æ˜çš„ï¼Œè€Œæ˜¯é€šè¿‡åé¢çš„ then æ–¹æ³•ä¼ å…¥çš„ï¼Œå³å»¶è¿Ÿä¼ å…¥ï¼Œè¿™å°±æ˜¯å›è°ƒå‡½æ•°å»¶è¿Ÿç»‘å®šã€‚æ¥ä¸‹æ¥æˆ‘ä»¬é’ˆå¯¹ä¸Šé¢çš„ä»£ç åšä¸€ä¸‹å¾®è°ƒï¼Œå¦‚ä¸‹æ‰€ç¤º

```js
let x = readFilePromise("1.json").then((data) => {
  return readFilePromise("2.json"); //è¿™æ˜¯è¿”å›çš„Promise
});

x.then(/* å†…éƒ¨é€»è¾‘çœç•¥ */);
```

æˆ‘ä»¬æ ¹æ® then ä¸­å›è°ƒå‡½æ•°çš„ä¼ å…¥å€¼åˆ›å»ºä¸åŒç±»å‹çš„ Promiseï¼Œç„¶åæŠŠè¿”å›çš„ Promise ç©¿é€åˆ°å¤–å±‚ï¼Œä»¥ä¾›åç»­çš„è°ƒç”¨ã€‚è¿™é‡Œçš„ x æŒ‡çš„å°±æ˜¯å†…éƒ¨è¿”å›çš„ Promiseï¼Œç„¶ååœ¨ x åé¢å¯ä»¥ä¾æ¬¡å®Œæˆé“¾å¼è°ƒç”¨ã€‚è¿™ä¾¿æ˜¯è¿”å›å€¼ç©¿é€çš„æ•ˆæœï¼Œè¿™ä¸¤ç§æŠ€æœ¯ä¸€èµ·ä½œç”¨ä¾¿å¯ä»¥å°†æ·±å±‚çš„åµŒå¥—å›è°ƒå†™æˆä¸‹é¢çš„å½¢å¼

```js
readFilePromise("1.json")
  .then((data) => {
    return readFilePromise("2.json");
  })
  .then((data) => {
    return readFilePromise("3.json");
  })
  .then((data) => {
    return readFilePromise("4.json");
  });
```

è¿™æ ·å°±æ˜¾å¾—æ¸…çˆ½äº†è®¸å¤šï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒæ›´ç¬¦åˆäººçš„çº¿æ€§æ€ç»´æ¨¡å¼ï¼Œå¼€å‘ä½“éªŒä¹Ÿæ›´å¥½ï¼Œä¸¤ç§æŠ€æœ¯ç»“åˆäº§ç”Ÿäº†é“¾å¼è°ƒç”¨çš„æ•ˆæœã€‚

è¿™æ ·è§£å†³äº†å¤šå±‚åµŒå¥—çš„é—®é¢˜ï¼Œé‚£å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œå³æ¯æ¬¡ä»»åŠ¡æ‰§è¡Œç»“æŸååˆ†åˆ«å¤„ç†æˆåŠŸå’Œå¤±è´¥çš„æƒ…å†µæ€ä¹ˆè§£å†³çš„å‘¢ï¼ŸPromise é‡‡ç”¨äº†é”™è¯¯å†’æ³¡çš„æ–¹å¼

```js
readFilePromise("1.json")
  .then((data) => {
    return readFilePromise("2.json");
  })
  .then((data) => {
    return readFilePromise("3.json");
  })
  .then((data) => {
    return readFilePromise("4.json");
  })
  .catch((err) => {
    // xxx
  });
```

è¿™æ ·å‰é¢äº§ç”Ÿçš„é”™è¯¯ä¼šä¸€ç›´å‘åä¼ é€’ï¼Œè¢« catch æ¥æ”¶åˆ°ï¼Œå°±ä¸ç”¨é¢‘ç¹åœ°æ£€æŸ¥é”™è¯¯äº†ã€‚ä»ä¸Šé¢çš„è¿™äº›ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒPromise è§£å†³æ•ˆæœä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼šå®ç°é“¾å¼è°ƒç”¨ï¼Œè§£å†³å¤šå±‚åµŒå¥—é—®é¢˜ï¼›å®ç°é”™è¯¯å†’æ³¡åä¸€ç«™å¼å¤„ç†ï¼Œè§£å†³æ¯æ¬¡ä»»åŠ¡ä¸­åˆ¤æ–­é”™è¯¯ã€å¢åŠ ä»£ç æ··ä¹±åº¦çš„é—®é¢˜

### Promise çš„é™æ€æ–¹æ³•

**all æ–¹æ³•**

è¯­æ³•ï¼š Promise.allï¼ˆiterableï¼‰

å‚æ•°ï¼š ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œå¦‚ Arrayã€‚

æè¿°ï¼š æ­¤æ–¹æ³•å¯¹äºæ±‡æ€»å¤šä¸ª promise çš„ç»“æœå¾ˆæœ‰ç”¨ï¼Œåœ¨ ES6 ä¸­å¯ä»¥å°†å¤šä¸ª Promise.all å¼‚æ­¥è¯·æ±‚å¹¶è¡Œæ“ä½œï¼Œè¿”å›ç»“æœä¸€èˆ¬æœ‰ä¸‹é¢ä¸¤ç§æƒ…å†µã€‚

å½“æ‰€æœ‰ç»“æœæˆåŠŸè¿”å›æ—¶æŒ‰ç…§è¯·æ±‚é¡ºåºè¿”å›æˆåŠŸã€‚

å½“å…¶ä¸­æœ‰ä¸€ä¸ªå¤±è´¥æ–¹æ³•æ—¶ï¼Œåˆ™è¿›å…¥å¤±è´¥æ–¹æ³•ã€‚

æˆ‘ä»¬æ¥çœ‹ä¸‹ä¸šåŠ¡çš„åœºæ™¯ï¼Œå¯¹äºä¸‹é¢è¿™ä¸ªä¸šåŠ¡åœºæ™¯é¡µé¢çš„åŠ è½½ï¼Œå°†å¤šä¸ªè¯·æ±‚åˆå¹¶åˆ°ä¸€èµ·ï¼Œç”¨ all æ¥å®ç°å¯èƒ½æ•ˆæœä¼šæ›´å¥½ï¼Œè¯·çœ‹ä»£ç ç‰‡æ®µã€‚

```js
//1.è·å–è½®æ’­æ•°æ®åˆ—è¡¨
function getBannerList() {
  return new Promise((resolve, reject) => {
    setTimeout(function() {
      resolve("è½®æ’­æ•°æ®");
    }, 300);
  });
}
//2.è·å–åº—é“ºåˆ—è¡¨
function getStoreList() {
  return new Promise((resolve, reject) => {
    setTimeout(function() {
      resolve("åº—é“ºæ•°æ®");
    }, 500);
  });
}
//3.è·å–åˆ†ç±»åˆ—è¡¨
function getCategoryList() {
  return new Promise((resolve, reject) => {
    setTimeout(function() {
      resolve("åˆ†ç±»æ•°æ®");
    }, 700);
  });
}
function initLoad() {
  Promise.all([getBannerList(), getStoreList(), getCategoryList()])
    .then((res) => {
      console.log(res);
    })
    .catch((err) => {
      console.log(err);
    });
}
initLoad();
```

ä»ä¸Šé¢ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œåœ¨ä¸€ä¸ªé¡µé¢ä¸­éœ€è¦åŠ è½½è·å–è½®æ’­åˆ—è¡¨ã€è·å–åº—é“ºåˆ—è¡¨ã€è·å–åˆ†ç±»åˆ—è¡¨è¿™ä¸‰ä¸ªæ“ä½œï¼Œé¡µé¢éœ€è¦åŒæ—¶å‘å‡ºè¯·æ±‚è¿›è¡Œé¡µé¢æ¸²æŸ“ï¼Œè¿™æ ·ç”¨ Promise.all æ¥å®ç°ï¼Œçœ‹èµ·æ¥æ›´æ¸…æ™°ã€ä¸€ç›®äº†ç„¶ã€‚

**allSettled æ–¹æ³•**

Promise.allSettled çš„è¯­æ³•åŠå‚æ•°è·Ÿ Promise.all ç±»ä¼¼ï¼Œå…¶å‚æ•°æ¥å—ä¸€ä¸ª Promise çš„æ•°ç»„ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ Promiseã€‚å”¯ä¸€çš„ä¸åŒåœ¨äºï¼Œæ‰§è¡Œå®Œä¹‹åä¸ä¼šå¤±è´¥ï¼Œä¹Ÿå°±æ˜¯è¯´å½“ Promise.allSettled å…¨éƒ¨å¤„ç†å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥æ‹¿åˆ°æ¯ä¸ª Promise çš„çŠ¶æ€ï¼Œè€Œä¸ç®¡å…¶æ˜¯å¦å¤„ç†æˆåŠŸã€‚

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç”¨ allSettled å®ç°çš„ä¸€æ®µä»£ç ã€‚

```js
const resolved = Promise.resolve(2);
const rejected = Promise.reject(-1);
const allSettledPromise = Promise.allSettled([resolved, rejected]);
allSettledPromise.then(function(results) {
  console.log(results);
});
// è¿”å›ç»“æœï¼š
// [
//    { status: 'fulfilled', value: 2 },
//    { status: 'rejected', reason: -1 }
// ]
```

ä»ä¸Šé¢ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒPromise.allSettled æœ€åè¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè®°å½•ä¼ è¿›æ¥çš„å‚æ•°ä¸­æ¯ä¸ª Promise çš„è¿”å›å€¼ï¼Œè¿™å°±æ˜¯å’Œ all æ–¹æ³•ä¸å¤ªä¸€æ ·çš„åœ°æ–¹ã€‚ä½ ä¹Ÿå¯ä»¥æ ¹æ® all æ–¹æ³•æä¾›çš„ä¸šåŠ¡åœºæ™¯çš„ä»£ç è¿›è¡Œæ”¹é€ ï¼Œå…¶å®ä¹Ÿèƒ½çŸ¥é“å¤šä¸ªè¯·æ±‚å‘å‡ºå»ä¹‹åï¼ŒPromise æœ€åè¿”å›çš„æ˜¯æ¯ä¸ªå‚æ•°çš„æœ€ç»ˆçŠ¶æ€ã€‚

**any æ–¹æ³•**

è¯­æ³•ï¼š Promise.anyï¼ˆiterableï¼‰

å‚æ•°ï¼š iterable å¯è¿­ä»£çš„å¯¹è±¡ï¼Œä¾‹å¦‚ Arrayã€‚

æè¿°ï¼š any æ–¹æ³•è¿”å›ä¸€ä¸ª Promiseï¼Œåªè¦å‚æ•° Promise å®ä¾‹æœ‰ä¸€ä¸ªå˜æˆ fulfilled çŠ¶æ€ï¼Œæœ€å any è¿”å›çš„å®ä¾‹å°±ä¼šå˜æˆ fulfilled çŠ¶æ€ï¼›å¦‚æœæ‰€æœ‰å‚æ•° Promise å®ä¾‹éƒ½å˜æˆ rejected çŠ¶æ€ï¼ŒåŒ…è£…å®ä¾‹å°±ä¼šå˜æˆ rejected çŠ¶æ€ã€‚

è¿˜æ˜¯å¯¹ä¸Šé¢ allSettled è¿™æ®µä»£ç è¿›è¡Œæ”¹é€ ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹æ”¹é€ å®Œçš„ä»£ç å’Œæ‰§è¡Œç»“æœã€‚

```js
const resolved = Promise.resolve(2);
const rejected = Promise.reject(-1);
const allSettledPromise = Promise.any([resolved, rejected]);
allSettledPromise.then(function(results) {
  console.log(results);
});
// è¿”å›ç»“æœï¼š
// 2
```

ä»æ”¹é€ åçš„ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œåªè¦å…¶ä¸­ä¸€ä¸ª Promise å˜æˆ fulfilled çŠ¶æ€ï¼Œé‚£ä¹ˆ any æœ€åå°±è¿”å›è¿™ä¸ª Promiseã€‚ç”±äºä¸Šé¢ resolved è¿™ä¸ª Promise å·²ç»æ˜¯ resolve çš„äº†ï¼Œæ•…æœ€åè¿”å›ç»“æœä¸º 2ã€‚

**race æ–¹æ³•**

è¯­æ³•ï¼š Promise.raceï¼ˆiterableï¼‰

å‚æ•°ï¼š iterable å¯è¿­ä»£çš„å¯¹è±¡ï¼Œä¾‹å¦‚ Arrayã€‚

æè¿°ï¼š race æ–¹æ³•è¿”å›ä¸€ä¸ª Promiseï¼Œåªè¦å‚æ•°çš„ Promise ä¹‹ä¸­æœ‰ä¸€ä¸ªå®ä¾‹ç‡å…ˆæ”¹å˜çŠ¶æ€ï¼Œåˆ™ race æ–¹æ³•çš„è¿”å›çŠ¶æ€å°±è·Ÿç€æ”¹å˜ã€‚é‚£ä¸ªç‡å…ˆæ”¹å˜çš„ Promise å®ä¾‹çš„è¿”å›å€¼ï¼Œå°±ä¼ é€’ç»™ race æ–¹æ³•çš„å›è°ƒå‡½æ•°ã€‚

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªä¸šåŠ¡åœºæ™¯ï¼Œå¯¹äºå›¾ç‰‡çš„åŠ è½½ï¼Œç‰¹åˆ«é€‚åˆç”¨ race æ–¹æ³•æ¥è§£å†³ï¼Œå°†å›¾ç‰‡è¯·æ±‚å’Œè¶…æ—¶åˆ¤æ–­æ”¾åˆ°ä¸€èµ·ï¼Œç”¨ race æ¥å®ç°å›¾ç‰‡çš„è¶…æ—¶åˆ¤æ–­ã€‚è¯·çœ‹ä»£ç ç‰‡æ®µã€‚

```js
//è¯·æ±‚æŸä¸ªå›¾ç‰‡èµ„æº
function requestImg() {
  var p = new Promise(function(resolve, reject) {
    var img = new Image();
    img.onload = function() {
      resolve(img);
    };
    img.src = "http://www.baidu.com/img/flexible/logo/pc/result.png";
  });
  return p;
}
//å»¶æ—¶å‡½æ•°ï¼Œç”¨äºç»™è¯·æ±‚è®¡æ—¶
function timeout() {
  var p = new Promise(function(resolve, reject) {
    setTimeout(function() {
      reject("å›¾ç‰‡è¯·æ±‚è¶…æ—¶");
    }, 5000);
  });
  return p;
}
Promise.race([requestImg(), timeout()])
  .then(function(results) {
    console.log(results);
  })
  .catch(function(reason) {
    console.log(reason);
  });
```

ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œé‡‡ç”¨ Promise çš„æ–¹å¼æ¥åˆ¤æ–­å›¾ç‰‡æ˜¯å¦åŠ è½½æˆåŠŸï¼Œä¹Ÿæ˜¯é’ˆå¯¹ Promise.race æ–¹æ³•çš„ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ä¸šåŠ¡åœºæ™¯ã€‚

::: tip å°ç»“
|Promise æ–¹æ³•|ç®€å•æ€»ç»“|
|:--:|:--:|
|all|å‚æ•°è¿”å›æ‰€æœ‰ç»“æœæˆåŠŸæ‰è¿”å›|
|allSettled|å‚æ•°ä¸è®ºè¿”å›ç»“æœæ˜¯å¦æˆåŠŸï¼Œéƒ½ä¼šè¿”å›æ¯ä¸ªå‚æ•°æ‰§è¡ŒçŠ¶æ€|
|any|å‚æ•°ä¸­åªè¦æœ‰ä¸€ä¸ªæˆåŠŸï¼Œå°±è¿”å›è¯¥æˆåŠŸçš„æ‰§è¡Œç»“æœ|
|race|é¡¾åæ€ä¹‰è¿”å›æœ€å…ˆè¿”å›æ‰§è¡ŒæˆåŠŸçš„å‚æ•°çš„æ‰§è¡Œç»“æœ|
:::
