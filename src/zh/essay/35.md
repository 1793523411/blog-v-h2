---
time: 2021-03-08
icon: template
category: é¢è¯•
article: true
sidebar: auto
footer: ğŸ˜ğŸ˜ğŸ˜
tag:
  - å‰ç«¯
  - React
---

# å‰ç«¯é¢è¯•-React-Router

## å‰ç«¯åœ¨è·¯ç”±ä¸Šçš„å››æ¬¡å˜åŒ–

1. æœ€åˆçš„è·¯ç”±ç®¡ç†æƒç”±åç«¯å®Œå…¨æ§åˆ¶ï¼Œå‰ç«¯é¡µé¢é€šè¿‡åœ¨æ¨¡æ¿ä¸­æ’å…¥åç«¯è¯­è¨€å˜é‡çš„æ–¹å¼å®Œæˆå¼€å‘ã€‚è¿™ä¸ªæ—¶ä»£æœ€æ˜æ˜¾çš„æŠ€æœ¯ç‰¹å¾æ˜¯ Java çš„ JSPã€‚è¿™æ ·çš„å¼€å‘æ–¹å¼æ•ˆç‡å¾ˆä½ï¼Œåœ¨å·¥ä½œååŒä¸Šï¼Œå‰åç«¯ç›¸äº’ä¸¥é‡ä¾èµ–

2. ä½†å½“ AJAX æŠ€æœ¯å…´èµ·åï¼Œå‰ç«¯ç½‘é¡µä¸å†ä¸åç«¯é¡µé¢ç›´æ¥è€¦åˆäº†ï¼Œå·¥ç¨‹ä¹Ÿå¾—ä»¥åˆ†ç¦»ã€‚è¿™ä¸ªæ—¶ä»£æœ€æ˜æ˜¾çš„ç‰¹å¾æ˜¯å¤šä¸ª HTML é¡µé¢ï¼Œå¹¶ç”± Nginx ç­‰é™æ€æ–‡ä»¶æœåŠ¡å®Œæˆæ‰˜ç®¡ï¼Œè¿™æ˜¯ç¬¬äºŒæ¬¡å˜åŒ–ã€‚åœ¨è¿™æ¬¡å˜åŒ–ä¸­è§£é™¤äº†å‰åç«¯å¼€å‘è€…çš„ç›´æ¥ä¾èµ–ï¼Œå‰ç«¯å¼€å‘è€…å¯ä»¥è‡ªè¡Œç»´æŠ¤ç‹¬ç«‹çš„å‰ç«¯å·¥ç¨‹ã€‚ä½†åœ¨è¿™ä¸ªå·¥ç¨‹ä¸­ï¼Œæœ‰å¤šä¸ª HTML éœ€è¦ç»´æŠ¤ï¼Œå®ƒä»¬å„è‡ªåˆ†ç¦»ï¼Œéœ€è¦å¼•ç”¨ä¸åŒçš„ JS ä¸ CSSï¼Œå¯¹äºå·¥ç¨‹å¤ç”¨åˆæ˜¯ä¸€ä¸ªéš¾é¢˜

3. äºæ˜¯è¿æ¥äº†ç¬¬ä¸‰æ¬¡å˜åŒ–ï¼Œåœ¨è¿™æ¬¡å˜åŒ–ä¸­ï¼Œæœ€æ˜æ˜¾çš„æ˜¯ JavaScript æˆä¸ºå‰ç«¯å¼€å‘çš„ä¸»è§’ï¼Œæ— è®ºæ˜¯ HTMLã€CSS è¿˜æ˜¯è·¯ç”±éƒ½é€šè¿‡ JavaScript æ¥æ§åˆ¶ã€‚åœ¨è¿™ä¸ªé˜¶æ®µä¸­ï¼Œæœ€å…·ç‰¹å¾çš„æŠ€æœ¯æ ˆæ˜¯ AngularJSã€‚æˆ‘ä»¬è¦çŸ¥é“ï¼Œå‰ç«¯å¹¶ä¸èƒ½çœŸæ­£åœ°å»æ§åˆ¶è·¯ç”±ï¼Œæ¯”å¦‚è¯·æ±‚ `http://example.com/a`ä¸ `http://example.com/b`ï¼Œä¸€å®šä¼šè¿”å›ä¸¤ä¸ªé¡µé¢ï¼Œè¿™å°±éœ€è¦ä¸€ç§æ–¹æ¡ˆå»æ¨¡æ‹Ÿè·¯ç”±ï¼Œæ‰€ä»¥ Hash è·¯ç”±ä½œä¸ºä¸€ä¸ªæŠ˜ä¸­çš„è§£å†³æ–¹æ¡ˆç™»ä¸Šäº†èˆå°ã€‚ç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼Œé€šè¿‡åœ¨ Hash ä¸­æ·»åŠ è·¯ç”±è·¯å¾„çš„æ–¹å¼æ§åˆ¶å‰ç«¯è·¯ç”±

```
http://example.com#a
http://example.com#b
```

Hash è·¯ç”±åœ¨å®è·µä¸Šéå¸¸æˆåŠŸï¼Œä½¿å¾—å¼€å‘è€…çš„æ³¨æ„åŠ›å¾—ä»¥ä»å‰ç«¯çš„ç¹æ‚ä¿¡æ¯ä¸­è¿›ä¸€æ­¥æ”¶æ•›ã€‚åœ¨ç°ä»£å‰ç«¯å·¥ç¨‹ä¸­ï¼Œä½ ä¼šå‘ç°å¤§éƒ¨åˆ†çš„ä»£ç éƒ½æ˜¯ç”± JavaScript ç‹¬ç«‹å®Œæˆçš„ï¼Œè¿™åœ¨æœ€åˆæ˜¯å®Œå…¨ä¸å¯æƒ³è±¡çš„

4. æ¥ä¸‹æ¥éšç€æµè§ˆå™¨å¯¹ HTML5 ä¸­ History pushState çš„æ”¯æŒï¼Œå‰ç«¯è·¯ç”±è¿æ¥äº†ç¬¬å››æ¬¡å˜åŒ–ã€‚è¿™æ¬¡æˆ‘ä»¬ç»ˆäºå¯ä»¥ä¸å†å†™ #a è¿™æ ·çš„è·¯ç”±äº†ï¼Œè€Œæ˜¯å›å½’åˆ°æœ€åˆçš„å†™æ³•â€”â€”`http://example.com/a`

## ä»€ä¹ˆæ˜¯å‰ç«¯è·¯ç”±

åœ¨å‰ç«¯æŠ€æœ¯æ—©æœŸï¼Œä¸€ä¸ª URL å¯¹åº”ä¸€ä¸ªé¡µé¢ï¼Œå¦‚æœä½ è¦ä» A é¡µé¢åˆ‡æ¢åˆ° B é¡µé¢ï¼Œé‚£ä¹ˆå¿…ç„¶ä¼´éšç€é¡µé¢çš„åˆ·æ–°ã€‚è¿™ä¸ªä½“éªŒå¹¶ä¸å¥½ï¼Œä¸è¿‡åœ¨æœ€åˆä¹Ÿæ˜¯æ— å¥ˆä¹‹ä¸¾â€”â€”æ¯•ç«Ÿç”¨æˆ·åªæœ‰åœ¨åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹ï¼Œæ‰å¯ä»¥é‡æ–°å»è¯·æ±‚æ•°æ®ã€‚

åæ¥ï¼Œæ”¹å˜å‘ç”Ÿäº†â€”â€”Ajax å‡ºç°äº†ï¼Œå®ƒå…è®¸äººä»¬åœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹å‘èµ·è¯·æ±‚ï¼›ä¸ä¹‹å…±ç”Ÿçš„ï¼Œè¿˜æœ‰â€œä¸åˆ·æ–°é¡µé¢å³å¯æ›´æ–°é¡µé¢å†…å®¹â€è¿™ç§éœ€æ±‚ã€‚åœ¨è¿™æ ·çš„èƒŒæ™¯ä¸‹ï¼Œå‡ºç°äº† SPAï¼ˆå•é¡µé¢åº”ç”¨ï¼‰

SPA æå¤§åœ°æå‡äº†ç”¨æˆ·ä½“éªŒï¼Œå®ƒå…è®¸é¡µé¢åœ¨ä¸åˆ·æ–°çš„æƒ…å†µä¸‹æ›´æ–°é¡µé¢å†…å®¹ï¼Œä½¿å†…å®¹çš„åˆ‡æ¢æ›´åŠ æµç•…ã€‚ä½†æ˜¯åœ¨ SPA è¯ç”Ÿä¹‹åˆï¼Œäººä»¬å¹¶æ²¡æœ‰è€ƒè™‘åˆ°â€œå®šä½â€è¿™ä¸ªé—®é¢˜â€”â€”åœ¨å†…å®¹åˆ‡æ¢å‰åï¼Œé¡µé¢çš„ URL éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™å°±å¸¦æ¥äº†ä¸¤ä¸ªé—®é¢˜ï¼š

SPA å…¶å®å¹¶ä¸çŸ¥é“å½“å‰çš„é¡µé¢â€œè¿›å±•åˆ°äº†å“ªä¸€æ­¥â€ï¼Œå¯èƒ½ä½ åœ¨ä¸€ä¸ªç«™ç‚¹ä¸‹ç»è¿‡äº†åå¤çš„â€œå‰è¿›â€æ‰ç»ˆäºå”¤å‡ºäº†æŸä¸€å—å†…å®¹ï¼Œä½†æ˜¯æ­¤æ—¶åªè¦åˆ·æ–°ä¸€ä¸‹é¡µé¢ï¼Œä¸€åˆ‡å°±ä¼šè¢«æ¸…é›¶ï¼Œä½ å¿…é¡»é‡å¤ä¹‹å‰çš„æ“ä½œæ‰å¯ä»¥é‡æ–°å¯¹å†…å®¹è¿›è¡Œå®šä½â€”â€”SPA å¹¶ä¸ä¼šâ€œè®°ä½â€ä½ çš„æ“ä½œï¼›

ç”±äºæœ‰ä¸”ä»…æœ‰ä¸€ä¸ª URL ç»™é¡µé¢åšæ˜ å°„ï¼Œè¿™å¯¹ SEO ä¹Ÿä¸å¤Ÿå‹å¥½ï¼Œæœç´¢å¼•æ“æ— æ³•æ”¶é›†å…¨é¢çš„ä¿¡æ¯

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå‰ç«¯è·¯ç”±å‡ºç°äº†

### SPAâ€œå®šä½â€è§£å†³æ–¹æ¡ˆ

å‰ç«¯è·¯ç”±å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨ä»…æœ‰ä¸€ä¸ªé¡µé¢çš„æƒ…å†µä¸‹ï¼Œâ€œè®°ä½â€ç”¨æˆ·å½“å‰èµ°åˆ°äº†å“ªä¸€æ­¥â€”â€”ä¸º SPA ä¸­çš„å„ä¸ªè§†å›¾åŒ¹é…ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ã€‚è¿™æ„å‘³ç€ç”¨æˆ·å‰è¿›ã€åé€€è§¦å‘çš„æ–°å†…å®¹ï¼Œéƒ½ä¼šæ˜ å°„åˆ°ä¸åŒçš„ URL ä¸Šå»ã€‚æ­¤æ—¶å³ä¾¿ä»–åˆ·æ–°é¡µé¢ï¼Œå› ä¸ºå½“å‰çš„ URL å¯ä»¥æ ‡è¯†å‡ºä»–æ‰€å¤„çš„ä½ç½®ï¼Œå› æ­¤å†…å®¹ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚

é‚£ä¹ˆå¦‚ä½•å®ç°è¿™ä¸ªç›®çš„å‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬è¦è§£å†³ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ã€‚

å½“ç”¨æˆ·åˆ·æ–°é¡µé¢æ—¶ï¼Œæµè§ˆå™¨ä¼šé»˜è®¤æ ¹æ®å½“å‰ URL å¯¹èµ„æºè¿›è¡Œé‡æ–°å®šä½ï¼ˆå‘é€è¯·æ±‚ï¼‰ã€‚è¿™ä¸ªåŠ¨ä½œå¯¹ SPA æ˜¯ä¸å¿…è¦çš„ï¼Œå› ä¸º SPA ä½œä¸ºå•é¡µé¢ï¼Œæ— è®ºå¦‚ä½•ä¹Ÿåªä¼šæœ‰ä¸€ä¸ªèµ„æºä¸ä¹‹å¯¹åº”ã€‚æ­¤æ—¶è‹¥èµ°æ­£å¸¸çš„è¯·æ±‚-åˆ·æ–°æµç¨‹ï¼Œåè€Œä¼šä½¿ç”¨æˆ·çš„å‰è¿›åé€€æ“ä½œæ— æ³•è¢«è®°å½•ã€‚

å•é¡µé¢åº”ç”¨å¯¹æœåŠ¡ç«¯æ¥è¯´ï¼Œå°±æ˜¯ä¸€ä¸ª URLã€ä¸€å¥—èµ„æºï¼Œé‚£ä¹ˆå¦‚ä½•åšåˆ°ç”¨â€œä¸åŒçš„ URLâ€æ¥æ˜ å°„ä¸åŒçš„è§†å›¾å†…å®¹å‘¢ï¼Ÿ

ä»è¿™ä¸¤ä¸ªé—®é¢˜æ¥çœ‹ï¼ŒæœåŠ¡ç«¯å·²ç»æ•‘ä¸äº† SPA è¿™ä¸ªåœºæ™¯äº†ã€‚æ‰€ä»¥è¦é å’±ä»¬å‰ç«¯è‡ªåŠ›æ›´ç”Ÿï¼Œä¸ç„¶æ€ä¹ˆå«â€œå‰ç«¯è·¯ç”±â€å‘¢ï¼Ÿä½œä¸ºå‰ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥æä¾›ä»¥ä¸‹è¿™æ ·çš„è§£å†³æ€è·¯ã€‚

1. æ‹¦æˆªç”¨æˆ·çš„åˆ·æ–°æ“ä½œï¼Œé¿å…æœåŠ¡ç«¯ç›²ç›®å“åº”ã€è¿”å›ä¸ç¬¦åˆé¢„æœŸçš„èµ„æºå†…å®¹ï¼ŒæŠŠåˆ·æ–°è¿™ä¸ªåŠ¨ä½œå®Œå…¨æ”¾åˆ°å‰ç«¯é€»è¾‘é‡Œæ¶ˆåŒ–æ‰ï¼›

2. æ„ŸçŸ¥ URL çš„å˜åŒ–ã€‚è¿™é‡Œä¸æ˜¯è¯´è¦æ”¹é€  URLã€å‡­ç©ºåˆ¶é€ å‡º N ä¸ª URL æ¥ã€‚è€Œæ˜¯è¯´ URL è¿˜æ˜¯é‚£ä¸ª URLï¼Œåªä¸è¿‡æˆ‘ä»¬å¯ä»¥ç»™å®ƒåšä¸€äº›å¾®å°çš„å¤„ç†ï¼Œè¿™äº›å¤„ç†å¹¶ä¸ä¼šå½±å“ URL æœ¬èº«çš„æ€§è´¨ï¼Œä¸ä¼šå½±å“æœåŠ¡å™¨å¯¹å®ƒçš„è¯†åˆ«ï¼Œåªæœ‰æˆ‘ä»¬å‰ç«¯èƒ½æ„ŸçŸ¥åˆ°ã€‚ä¸€æ—¦æˆ‘ä»¬æ„ŸçŸ¥åˆ°äº†ï¼Œæˆ‘ä»¬å°±æ ¹æ®è¿™äº›å˜åŒ–ã€ç”¨ JS å»ç»™å®ƒç”Ÿæˆä¸åŒçš„å†…å®¹ã€‚

### hash ä¸ history

ç°åœ¨å‰ç«¯ç•Œå¯¹å‰ç«¯è·¯ç”±æœ‰å“ªäº›å®ç°æ€è·¯ï¼Ÿ hash ä¸ history

hash æ¨¡å¼æ˜¯æŒ‡é€šè¿‡æ”¹å˜ URL åé¢ä»¥â€œ#â€åˆ†éš”çš„å­—ç¬¦ä¸²ï¼ˆè¿™è´§å…¶å®å°±æ˜¯ URL ä¸Šçš„å“ˆå¸Œå€¼ï¼‰ï¼Œä»è€Œè®©é¡µé¢æ„ŸçŸ¥åˆ°è·¯ç”±å˜åŒ–çš„ä¸€ç§å®ç°æ–¹å¼

åœ¨ hash æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å®ç°è·¯ç”±çš„æ€è·¯å¯ä»¥æ¦‚æ‹¬å¦‚ä¸‹ï¼š

1. hash çš„æ”¹å˜ï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡ location æš´éœ²å‡ºæ¥çš„å±æ€§ï¼Œç›´æ¥å»ä¿®æ”¹å½“å‰ URL çš„ hash å€¼
2. hash çš„æ„ŸçŸ¥ï¼šé€šè¿‡ç›‘å¬ â€œhashchangeâ€äº‹ä»¶ï¼Œå¯ä»¥ç”¨ JS æ¥æ•æ‰ hash å€¼çš„å˜åŒ–ï¼Œè¿›è€Œå†³å®šæˆ‘ä»¬é¡µé¢å†…å®¹æ˜¯å¦éœ€è¦æ›´æ–°

é€šè¿‡ç‚¹å‡»å‰è¿›åé€€ç®­å¤´ï¼Œå°±å¯ä»¥å®ç°é¡µé¢é—´çš„è·³è½¬ã€‚è¿™æ ·çš„è¡Œä¸ºï¼Œå…¶å®æ˜¯å¯ä»¥é€šè¿‡ API æ¥å®ç°çš„,æµè§ˆå™¨çš„ history API èµ‹äºˆäº†æˆ‘ä»¬è¿™æ ·çš„èƒ½åŠ›ï¼Œåœ¨ HTML 4 æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ¥å£æ¥æ“ä½œæµè§ˆå†å²ã€å®ç°è·³è½¬åŠ¨ä½œ

```js
window.history.forward(); // å‰è¿›åˆ°ä¸‹ä¸€é¡µ
window.history.back(); // åé€€åˆ°ä¸Šä¸€é¡µ
window.history.go(2); // å‰è¿›ä¸¤é¡µ
window.history.go(-2); // åé€€ä¸¤é¡µ
```

é—æ†¾çš„æ˜¯ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬èƒ½åšçš„åªæ˜¯â€œåˆ‡æ¢â€ï¼Œè€Œä¸èƒ½â€œæ”¹å˜â€ã€‚å¥½åœ¨ä» HTML 5 å¼€å§‹ï¼Œæµè§ˆå™¨æ”¯æŒäº† pushState å’Œ replaceState ä¸¤ä¸ª APIï¼Œå…è®¸æˆ‘ä»¬å¯¹æµè§ˆå†å²è¿›è¡Œä¿®æ”¹å’Œæ–°å¢

```js
history.pushState(data[,title][,url]); // å‘æµè§ˆå†å²ä¸­è¿½åŠ ä¸€æ¡è®°å½•
history.replaceState(data[,title][,url]); // ä¿®æ”¹ï¼ˆæ›¿æ¢ï¼‰å½“å‰é¡µåœ¨æµè§ˆå†å²ä¸­çš„ä¿¡æ¯
```

è¿™æ ·ä¸€æ¥ï¼Œä¿®æ”¹åŠ¨ä½œå°±é½æ´»äº†ã€‚

æœ‰ä¿®æ”¹ï¼Œå°±è¦æœ‰å¯¹ä¿®æ”¹çš„æ„ŸçŸ¥èƒ½åŠ›ã€‚åœ¨ history æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç›‘å¬ popstate äº‹ä»¶æ¥è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ï¼š

```js
window.addEventListener("popstate", function(e) {
  console.log(e);
});
```

æ¯å½“æµè§ˆå†å²å‘ç”Ÿå˜åŒ–ï¼Œpopstate äº‹ä»¶éƒ½ä¼šè¢«è§¦å‘ã€‚

::: tip
æ³¨ï¼šgoã€forward å’Œ back ç­‰æ–¹æ³•çš„è°ƒç”¨ç¡®å®ä¼šè§¦å‘ popstateï¼Œä½†æ˜¯ pushState å’Œ replaceState ä¸ä¼šã€‚ä¸è¿‡è¿™ä¸€ç‚¹é—®é¢˜ä¸å¤§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰äº‹ä»¶å’Œå…¨å±€äº‹ä»¶æ€»çº¿æ¥æ‰‹åŠ¨è§¦å‘äº‹ä»¶
:::

## react-router çš„ä½¿ç”¨

```js
import React from "react";
// å¼•å…¥ React-Router ä¸­çš„ç›¸å…³ç»„ä»¶
import { BrowserRouter as Router, Route, Link } from "react-router-dom";
// å¯¼å‡ºç›®æ ‡ç»„ä»¶
const BasicExample = () => (
  // ç»„ä»¶æœ€å¤–å±‚ç”¨ Router åŒ…è£¹
  <Router>
    <div>
      <ul>
        <li>
          // å…·ä½“çš„æ ‡ç­¾ç”¨ Link åŒ…è£¹
          <Link to="/">Home</Link>
        </li>
        <li>
          // å…·ä½“çš„æ ‡ç­¾ç”¨ Link åŒ…è£¹
          <Link to="/about">About</Link>
        </li>
        <li>
          // å…·ä½“çš„æ ‡ç­¾ç”¨ Link åŒ…è£¹
          <Link to="/dashboard">Dashboard</Link>
        </li>
      </ul>
      <hr />
      // Route æ˜¯ç”¨äºå£°æ˜è·¯ç”±æ˜ å°„åˆ°åº”ç”¨ç¨‹åºçš„ç»„ä»¶å±‚
      <Route exact path="/" component={Home} />
      <Route path="/about" component={About} />
      <Route path="/dashboard" component={Dashboard} />
    </div>
  </Router>
);
// Home ç»„ä»¶çš„å®šä¹‰
const Home = () => (
  <div>
    <h2>Home</h2>
  </div>
);
// About ç»„ä»¶çš„å®šä¹‰
const About = () => (
  <div>
    <h2>About</h2>
  </div>
);
// Dashboard çš„å®šä¹‰
const Dashboard = () => (
  <div>
    <h2>Dashboard</h2>
  </div>
);

export default BasicExample;
```

ä»£ç ä¸­å¼•å…¥ 3 ä¸ªç»„ä»¶ä¹Ÿå°±ä»£è¡¨äº† React-Router ä¸­çš„ 3 ä¸ªæ ¸å¿ƒè§’è‰²ï¼š

- è·¯ç”±å™¨ï¼Œæ¯”å¦‚ BrowserRouter å’Œ HashRouter
- è·¯ç”±ï¼Œæ¯”å¦‚ Route å’Œ Switch
- å¯¼èˆªï¼Œæ¯”å¦‚ Linkã€NavLinkã€Redirect

è·¯ç”±ï¼ˆä»¥ Route ä¸ºä»£è¡¨ï¼‰è´Ÿè´£å®šä¹‰è·¯å¾„ä¸ç»„ä»¶ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œè€Œå¯¼èˆªï¼ˆä»¥ Link ä¸ºä»£è¡¨ï¼‰è´Ÿè´£è§¦å‘è·¯å¾„çš„æ”¹å˜ï¼Œè·¯ç”±å™¨ï¼ˆåŒ…æ‹¬ BrowserRouter å’Œ HashRouterï¼‰åˆ™ä¼šæ ¹æ® Route å®šä¹‰å‡ºæ¥çš„æ˜ å°„å…³ç³»ï¼Œä¸ºæ–°çš„è·¯å¾„åŒ¹é…å®ƒå¯¹åº”çš„é€»è¾‘ã€‚

ä»¥ä¸Šä¾¿æ˜¯ 3 ä¸ªè§’è‰²â€œæ‰“é…åˆâ€çš„è¿‡ç¨‹ã€‚è¿™å…¶ä¸­ï¼Œæœ€éœ€è¦æ³¨æ„çš„æ˜¯è·¯ç”±å™¨è¿™ä¸ªè§’è‰²ï¼ŒReact Router æ›¾åœ¨è¯´æ˜æ–‡æ¡£ä¸­å®˜å®£å®ƒæ˜¯â€œReact Router åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒâ€ã€‚å› æ­¤å­¦ä¹  React Routerï¼Œæœ€è¦ç´§çš„æ˜¯ææ˜ç™½è·¯ç”±å™¨çš„å·¥ä½œæœºåˆ¶

## è·¯ç”±å™¨ Router

è·¯ç”±å™¨è´Ÿè´£æ„ŸçŸ¥è·¯ç”±çš„å˜åŒ–å¹¶ä½œå‡ºååº”ï¼Œå®ƒæ˜¯æ•´ä¸ªè·¯ç”±ç³»ç»Ÿä¸­æœ€ä¸ºé‡è¦çš„ä¸€ç¯ã€‚React-Router æ”¯æŒæˆ‘ä»¬ä½¿ç”¨ hashï¼ˆå¯¹åº” HashRouterï¼‰å’Œ browserï¼ˆå¯¹åº” BrowserRouterï¼‰ ä¸¤ç§è·¯ç”±è§„åˆ™

ç¿»å¼€ React Router çš„ä»£ç ï¼Œä½ ä¼šå‘ç° React Router æä¾›äº†ä¸‰ä¸ªåº“ï¼Œåˆ†åˆ«æ˜¯ react-routerã€react-router-dom åŠ react-router-nativeã€‚ä½†å¦‚æœç»†çœ‹ï¼Œä½ ä¼šå‘ç° react-router æ˜¯æ²¡æœ‰ UI å±‚çš„ï¼Œreact-router-dom = react-router + Dom UIï¼Œè€Œ react-router-native = react-router + native UIã€‚DOM ç‰ˆæœ¬ä¸ Native ç‰ˆæœ¬æœ€å¤§é™åº¦åœ°å¤ç”¨äº†åŒä¸€ä¸ªåº•å±‚è·¯ç”±é€»è¾‘ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º

![](https://s0.lgstatic.com/i/image/M00/92/B5/CgqCHmASbgeAENJNAAAVuHLm4y4724.png)

åœ¨ DOM ç‰ˆæœ¬ä¸­æä¾›çš„åŸºç¡€è·¯ç”±æ˜¯ BrowserRouterï¼Œå®ƒçš„æºç æ˜¯è¿™æ ·çš„ï¼š

```js
import { Router } from "react-router";
import { createBrowserHistory as createHistory } from "history";
class BrowserRouter extends React.Component {
  history = createHistory(this.props);
  render() {
    return <Router history={this.history} children={this.props.children} />;
  }
}
```

é‚£è¿™æ®µæºç åšäº†ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ render éƒ¨åˆ†ç›´æ¥åº”ç”¨äº† react-router ä¸­çš„ Router ç»„ä»¶ï¼Œåœ¨ history å±æ€§ä¸­èµ‹å€¼äº† createBrowserHistory ç”Ÿæˆçš„å˜é‡ã€‚åœ¨ react-router-native ç‰ˆæœ¬ä¸­ä»£ç å®Œå…¨ä¸€æ ·ï¼Œåªæ˜¯æŠŠ createBrowserHistory æ›¿æ¢æˆäº† createMemoryHistoryã€‚æ‰€ä»¥çœŸæ­£çš„è·¯ç”±å¤„ç†è§’è‰²å…¶å®æ˜¯ history åº“

::: tip
æ€»ç»“ä¸€ä¸‹ï¼Œåœ¨ React Router ä¸­è·¯ç”±é€šè¿‡æŠ½è±¡ history åº“ç»Ÿä¸€ç®¡ç†å®Œæˆï¼Œhistory åº“æ”¯æŒ BrowserHistory ä¸ MemoryHistory ä¸¤ç§ç±»å‹ã€‚æ‰“å¼€æºç çœ‹ä¸€ä¸‹ BrowserHistory å®é™…ä¸Šè°ƒç”¨çš„å°±æ˜¯æµè§ˆå™¨çš„ History APIï¼Œä¹Ÿå°±æ˜¯åŸºç¡€åŸç†çš„éƒ¨åˆ†ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜æœ‰ MemoryHistory å‘¢ï¼Ÿå› ä¸º React Native å¹¶ä¸æ˜¯è¿è¡Œåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œæ‰€ä»¥éœ€è¦åœ¨å†…å­˜ä¸­æ„å»ºä¸€ä¸ªè‡ªå·±çš„ç‰ˆæœ¬ï¼ŒåŸç†ä¸Šå°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹[è¿™å—ä»£ç çš„ 886 è¡Œ](https://github.com/ReactTraining/history/blob/master/packages/history/index.ts#L886)
:::

## HashRouter ä¸ BrowserRouter

```js
import React from "react";
import { Router } from "react-router";
import { createBrowserHistory as createHistory } from "history";
import PropTypes from "prop-types";
import warning from "tiny-warning";

/**
 * The public API for a <Router> that uses HTML5 history.
 */
class BrowserRouter extends React.Component {
  history = createHistory(this.props);

  render() {
    return <Router history={this.history} children={this.props.children} />;
  }
}
```

```js
import React from "react";
import { Router } from "react-router";
import { createHashHistory as createHistory } from "history";
import PropTypes from "prop-types";
import warning from "tiny-warning";

/**
 * The public API for a <Router> that uses window.location.hash.
 */
class HashRouter extends React.Component {
  history = createHistory(this.props);

  render() {
    return <Router history={this.history} children={this.props.children} />;
  }
}
```

é€šè¿‡å¯¹æ¯”å‘ç°ä¸Šé¢ä¸¤éƒ¨åˆ†ä»£ç æƒŠäººçš„ç›¸ä¼¼ï¼Œå³å®ƒä»¬è°ƒç”¨çš„ history å®ä¾‹åŒ–æ–¹æ³•ä¸åŒï¼šHashRouter è°ƒç”¨äº† createHashHistoryï¼ŒBrowserRouter è°ƒç”¨äº† createBrowserHistory

createBrowserHistoryï¼šå®ƒå°†åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ HTML5 history API æ¥å¤„ç† URLï¼Œå®ƒèƒ½å¤Ÿå¤„ç†å½¢å¦‚è¿™æ ·çš„ URLï¼Œexample.com/some/pathã€‚ç”±æ­¤å¯å¾—ï¼ŒBrowserRouter æ˜¯ä½¿ç”¨ HTML 5 çš„ history API æ¥æ§åˆ¶è·¯ç”±è·³è½¬çš„

```js
/**
 * Browser history stores the location in regular URLs. This is the standard for
 * most web apps, but it requires some configuration on the server to ensure you
 * serve the same app at multiple URLs.
 *
 * @see https://github.com/ReactTraining/history/tree/master/docs/api-reference.md#createbrowserhistory
 */
```

createHashHistoryï¼šå®ƒæ˜¯ä½¿ç”¨ hash tag (#) å¤„ç† URL çš„æ–¹æ³•ï¼Œèƒ½å¤Ÿå¤„ç†å½¢å¦‚è¿™æ ·çš„ URLï¼Œexample.com/#/some/pathã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒçš„æºç ä¸­å¯¹å„ç§æ–¹æ³•çš„å®šä¹‰åŸºæœ¬éƒ½å›´ç»• hash å±•å¼€ï¼‰ï¼Œç”±æ­¤å¯å¾—ï¼ŒHashRouter æ˜¯é€šè¿‡ URL çš„ hash å±æ€§æ¥æ§åˆ¶è·¯ç”±è·³è½¬çš„

```js
function getBaseHref() {
  let base = document.querySelector("base");
  let href = "";

  if (base && base.getAttribute("href")) {
    let url = window.location.href;
    let hashIndex = url.indexOf("#");
    href = hashIndex === -1 ? url : url.slice(0, hashIndex);
  }

  return href;
}

function createHref(to: To) {
  return getBaseHref() + "#" + (typeof to === "string" ? to : createPath(to));
}
```

## è®¾è®¡æ¨¡å¼

### Monorepo

è¦ç†è§£ React Router çš„è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬ä¸å¦¨å…ˆçœ‹ä¸€ä¸‹ä»£ç ç›®å½•ç»“æ„,æ•´ä¸ªä»£ç è¢«åˆ†å‰²æˆäº†å››ä¸ªæ–‡ä»¶å¤¹ï¼Œè¿™å››ä¸ªæ–‡ä»¶å¤¹åˆå„è‡ªæ˜¯ä¸€ä¸ªåº“ï¼Œé‚£è¿™å››ä¸ªåº“å¦‚ä½•è”åŠ¨çš„å‘¢ï¼Ÿè¿™é‡Œç”¨åˆ°äº† Monorepo çš„è®¾è®¡

ä¸ Monorepo ç›¸å¯¹çš„æ¦‚å¿µæ˜¯ Multirepoã€‚Multirepo å°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„å¼€å‘æ¨¡å¼ï¼Œä¸€ä¸ªä»“åº“å¯¹åº”ä¸€ä¸ªå·¥ç¨‹ï¼Œå­å›¢é˜Ÿè‡ªè¡Œç»´æŠ¤ã€‚å¦‚æœè¿™å‡ ä¸ªå·¥ç¨‹å­˜åœ¨å¼ºååŒï¼Œéœ€è¦åœ¨ä¸€ä¸ªè¿­ä»£å‘¨æœŸä¸­å®Œæˆæ–°åŠŸèƒ½ä¸Šçº¿ï¼Œé‚£æ²Ÿé€šåè°ƒæˆæœ¬å°±éå¸¸å¤§äº†ï¼Œä½ éœ€è¦ç­‰åˆ«çš„å·¥ç¨‹å‘å¸ƒæ›´æ–°åæ‰èƒ½å¼€å‘ã€‚æ‰€ä»¥åœ¨è¿™é‡Œ React Router ä½¿ç”¨äº† Monorepo çš„å·¥ç¨‹æ¶æ„ï¼Œä½¿å·¥ç¨‹ä»£ç å¯¹å›¢é˜Ÿä¸­çš„æ¯ä¸€ä¸ªäººéƒ½å…·å¤‡é€æ˜åº¦ã€‚åœ¨åŒä¸€æ¬¡è¿­ä»£ä¸­ï¼Œåº“ä¹‹é—´äº’ç›¸å¼•ç”¨ä»£ç ä¹Ÿæ›´ä¸ºå®¹æ˜“ã€‚å…³äº Multirepo å’Œ Monorepo çš„åŒºåˆ«å¦‚ä¸‹å›¾æ‰€ç¤º

![](https://s0.lgstatic.com/i/image/M00/92/AA/Ciqc1GASbiuAZi47AAMc6IEs2Ww683.png)

### Context

ç¬¬äºŒä¸ªæ¯”è¾ƒé‡è¦çš„è®¾è®¡æ¨¡å¼æ˜¯ä½¿ç”¨ Context API å®Œæˆæ•°æ®å…±äº«

```js
//RouterContext.js
import createNamedContext from "./createNameContext";

const context = /*#__PURE__*/ createNamedContext("Router");
export default context;
```

```js
//createNameContext.js
// TODO: Replace with React.createContext once we can assume React 16+
import createContext from "mini-create-react-context";

const createNamedContext = (name) => {
  const context = createContext();
  context.displayName = name;

  return context;
};

export default createNamedContext;
```

```js
//withRouter.js
import RouterContext from "./RouterContext.js";

/**
 * A public higher-order component to access the imperative API
 */
function withRouter(Component) {
  const displayName = `withRouter(${Component.displayName || Component.name})`;
  const C = (props) => {
    const { wrappedComponentRef, ...remainingProps } = props;

    return (
      <RouterContext.Consumer>
        {(context) => {
          invariant(
            context,
            `You should not use <${displayName} /> outside a <Router>`
          );
          return (
            <Component
              {...remainingProps}
              {...context}
              ref={wrappedComponentRef}
            />
          );
        }}
      </RouterContext.Consumer>
    );
  };

  C.displayName = displayName;
  C.WrappedComponent = Component;

  if (__DEV__) {
    C.propTypes = {
      wrappedComponentRef: PropTypes.oneOfType([
        PropTypes.string,
        PropTypes.func,
        PropTypes.object,
      ]),
    };
  }

  return hoistStatics(C, Component);
}

export default withRouter;
```

### å…³é”®æ¨¡å—

ä»åŠŸèƒ½è§’åº¦ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ React Router çš„ç»„ä»¶åˆ†ä¸ºä¸‰ç±»ï¼š

1. Context å®¹å™¨ï¼Œåˆ†åˆ«æ˜¯ Router ä¸ MemoryRouterï¼Œä¸»è¦æä¾›ä¸Šä¸‹æ–‡æ¶ˆè´¹å®¹å™¨ï¼›

2. ç›´æ¥æ¶ˆè´¹è€…ï¼Œæä¾›è·¯ç”±åŒ¹é…åŠŸèƒ½ï¼Œåˆ†åˆ«æ˜¯ Routeã€Redirectã€Switchï¼›

3. ä¸å¹³å°å…³è”çš„åŠŸèƒ½ç»„ä»¶ï¼Œåˆ†åˆ«æ˜¯ react-router-dom ä¸­çš„ Linkã€NavLink ä»¥åŠ react-router-native ä¸­çš„ DeepLinkingã€‚
